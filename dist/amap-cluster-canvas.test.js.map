{"version":3,"file":"amap-cluster-canvas.test.js","sources":["../src/canvas.js","../src/clusterItem.js","../src/amap.coordinate.js","../src/utils.js","../src/mercator.coordinate.js","../src/event.js","../src/cluster.js","../test/index.js"],"sourcesContent":["/**\r\n * 为点聚合提供画布\r\n * @param options\r\n * {\r\n *   map: 地图,\r\n *   zIndex: 图层zIndex,\r\n *   visible: 是否可见\r\n * }\r\n */\r\nclass Canvas {\r\n  constructor( options ) {\r\n    this.layer = null\r\n    this.hoverCanvas = null\r\n    this.hoverCanvasCtx = null\r\n    this.clusterCanvas = null\r\n    this.clusterCanvasCxt = null\r\n    this.options = options\r\n    this.pixelRatio = this.getPixelRatio()\r\n    this.init()\r\n  }\r\n  init() {\r\n    const {\r\n      options: { map, visible, zIndex, render }\r\n    } = this\r\n    const container = document.createElement( 'div' )\r\n    // 绘制聚合点\r\n    const clusterCanvas = document.createElement( 'canvas' )\r\n    clusterCanvas.style.position = 'absolute'\r\n    // hover状态下的点绘制\r\n    const hoverCanvas = document.createElement( 'canvas' )\r\n    hoverCanvas.style.position = 'absolute'\r\n    container.appendChild( clusterCanvas )\r\n    container.appendChild( hoverCanvas )\r\n    this.clusterCanvas = clusterCanvas\r\n    this.hoverCanvas = hoverCanvas\r\n    this.clusterCanvasCxt = clusterCanvas.getContext( '2d' )\r\n    this.hoverCanvasCtx = hoverCanvas.getContext( '2d' )\r\n\r\n    this.layer = new AMap.CustomLayer( container, {\r\n      map,\r\n      zIndex,\r\n      visible,\r\n      zooms: [1, 20]\r\n    } )\r\n    this.layer.render = render\r\n  }\r\n  // 设备像素比\r\n  getPixelRatio() {\r\n    return Math.min( 2, Math.round( window.devicePixelRatio || 1 ) )\r\n  }\r\n  // 设置canvas的width&height属性可以清理画布\r\n  setCanvasSize( canvas, w, h ) {\r\n    const { pixelRatio } = this\r\n    canvas.width = w * pixelRatio\r\n    canvas.height = h * pixelRatio\r\n    canvas.style.width = w + 'px'\r\n    canvas.style.height = h + 'px'\r\n  }\r\n}\r\n\r\nexport default Canvas\r\n","class ClusterItem {\r\n  constructor( point, options ) {\r\n    this.renderPixel = null\r\n    this.points = [point]\r\n    this.coordinate = point.coordinate\r\n    this.averageCenter = options.averageCenter\r\n    this.coordinateEngine = options.coordinateEngine\r\n  }\r\n  getCount() {\r\n    return this.points.length\r\n  }\r\n  // 更新聚合点的中心点\r\n  updateCenter() {\r\n    const {\r\n      averageCenter,\r\n      points,\r\n      points: { length },\r\n      coordinate: { x: centerX, y: centerY }\r\n    } = this\r\n    if ( averageCenter ) {\r\n      const newAddPoint = points[length - 1]\r\n      const {\r\n        coordinate: { x: pointX, y: pointY }\r\n      } = newAddPoint\r\n      const totalX = centerX * ( length - 1 )\r\n      const totalY = centerY * ( length - 1 )\r\n      const newCenterX = ( totalX + pointX ) / length\r\n      const newCenterY = ( totalY + pointY ) / length\r\n      this.coordinate = {\r\n        x: newCenterX,\r\n        y: newCenterY\r\n      }\r\n      this.renderPixel = this.coordinateEngine.coordinateToPixel( this )\r\n    } else {\r\n      const centerPoint = this.points[0]\r\n      this.coordinate = centerPoint.coordinate\r\n      this.renderPixel = centerPoint.renderPixel\r\n    }\r\n  }\r\n  // 往聚合中添加点\r\n  addPoint( point ) {\r\n    this.points.push( point )\r\n    this.updateCenter()\r\n  }\r\n  // 判断一个点是否在改聚合范围内\r\n  contains( point ) {\r\n    const {\r\n      coordinate: { x: pointX, y: pointY }\r\n    } = point\r\n    const {\r\n      coordinate: { x: centerX, y: centerY }\r\n    } = this\r\n    const gridSize = this.coordinateEngine.getGridSize()\r\n    return (\r\n      pointX >= centerX - gridSize &&\r\n      pointX <= centerX + gridSize &&\r\n      pointY >= centerY - gridSize &&\r\n      pointY <= centerY + gridSize\r\n    )\r\n  }\r\n}\r\n\r\nexport default ClusterItem\r\n","export default class AmapCoordinate {\r\n  constructor( options ) {\r\n    this.map = options.map\r\n    this.gridSize = options.gridSize\r\n  }\r\n  getGridSize() {\r\n    return this.gridSize\r\n  }\r\n  getRenderData( data ) {\r\n    const renderData = []\r\n    const bounds = this.map.getBounds()\r\n    data.forEach( item => {\r\n      if ( bounds.contains( item.position ) ) {\r\n        // 经纬度转换为相对于地图容器的坐标\r\n        const coordinate = this.map.lngLatToContainer( item.position )\r\n        renderData.push( {\r\n          ...item,\r\n          coordinate,\r\n          renderPixel: coordinate\r\n        } )\r\n      }\r\n    } )\r\n    return renderData\r\n  }\r\n  coordinateToPixel( point ) {\r\n    return point.coordinate\r\n  }\r\n}\r\n","// 经纬度转墨卡托\r\nexport function lonLat2Mercator( lonLat ) {\r\n  const [longitude, latitude] = lonLat\r\n  let x = ( longitude * 20037508.34 ) / 180\r\n  let y =\r\n    Math.log( Math.tan( ( ( 90 + latitude ) * Math.PI ) / 360 ) ) / ( Math.PI / 180 )\r\n  y = ( y * 20037508.34 ) / 180\r\n  return {\r\n    x,\r\n    y\r\n  }\r\n}\r\n// 墨卡托转经纬度\r\nexport function mercator2LonLat( pixel ) {\r\n  const { x, y } = pixel\r\n  let longitude = ( x / 20037508.34 ) * 180\r\n  let latitude = ( y / 20037508.34 ) * 180\r\n  latitude =\r\n    ( 180 / Math.PI ) *\r\n    ( 2 * Math.atan( Math.exp( ( latitude * Math.PI ) / 180 ) ) - Math.PI / 2 )\r\n\r\n  return [longitude, latitude]\r\n}\r\n/**\r\n * 获取 offset 的值\r\n * @param {number} value\r\n * @param {any} offset\r\n * 1. offset 纯数字\r\n * 2. offset 百分比\r\n * 3. 默认返回 Number.parseFloat 的值\r\n */\r\nfunction getOffsetValue( value, offset ) {\r\n  const type = typeof offset\r\n  switch ( type ) {\r\n    case 'number':\r\n      return offset\r\n    case 'string':\r\n      const _offset = offset.trim()\r\n      if ( _offset.substr( -1 ) === '%' ) {\r\n        return value * ( Number.parseFloat( offset ) / 100 )\r\n      }\r\n      return Number.parseFloat( offset )\r\n    default:\r\n      return Number.parseFloat( offset )\r\n  }\r\n}\r\n// 解析 offset 参数\r\nexport function getOffset( style, offset ) {\r\n  if ( !Array.isArray( offset ) ) {\r\n    return [0, 0]\r\n  }\r\n  const { width, height } = style\r\n  return [getOffsetValue( width, offset[0] ), getOffsetValue( height, offset[1] )]\r\n}\r\n","import { lonLat2Mercator, mercator2LonLat } from './utils'\r\n\r\nexport default class MercatorCoordinate {\r\n  constructor( options ) {\r\n    this.map = options.map\r\n    this.gridSize = options.gridSize\r\n  }\r\n  getGridSize() {\r\n    return this.gridSize * Math.pow( 2, 18 - this.map.getZoom() )\r\n  }\r\n  getRenderData( data ) {\r\n    const renderData = []\r\n    const bounds = this.getExtendedBounds()\r\n    data.forEach( item => {\r\n      let { coordinate, renderPixel } = item\r\n      if ( !coordinate ) {\r\n        coordinate = lonLat2Mercator( item.position )\r\n        renderPixel = this.coordinateToPixel( item )\r\n      }\r\n      if ( this.contains( bounds, coordinate ) ) {\r\n        renderData.push( {\r\n          ...item,\r\n          coordinate,\r\n          renderPixel\r\n        } )\r\n      }\r\n    } )\r\n    return renderData\r\n  }\r\n  getExtendedBounds() {\r\n    const gridSize = this.getGridSize()\r\n    const bounds = this.map.getBounds()\r\n    const southWest = bounds.getSouthWest()\r\n    const northEast = bounds.getNorthEast()\r\n    // 上右\r\n    const tr = lonLat2Mercator( [southWest.lng, southWest.lat] )\r\n    // 下左\r\n    const bl = lonLat2Mercator( [northEast.lng, northEast.lat] )\r\n    tr.x -= gridSize\r\n    tr.y -= gridSize\r\n    bl.x += gridSize\r\n    bl.y += gridSize\r\n    return [tr, bl]\r\n  }\r\n  coordinateToPixel( point ) {\r\n    return this.map.lngLatToContainer(\r\n      point.position || mercator2LonLat( point.coordinate )\r\n    )\r\n  }\r\n  contains( bounds, coordinate ) {\r\n    const [tr, bl] = bounds\r\n    const { x, y } = coordinate\r\n    // 小于等于0 ：地图缩放到最小，世界地图都在视图内\r\n    return bl.x <= 0 || ( x >= tr.x && x <= bl.x && y >= tr.y && y <= bl.y )\r\n  }\r\n}\r\n","export default class Event {\r\n  constructor(cluster) {\r\n    this.hoverPoint = null\r\n    this.cluster = cluster\r\n    this.map = cluster.options.map\r\n    this.click = cluster.options.clickHandler\r\n    this.mouseout = cluster.options.mouseoutHandler\r\n    this.mouseover = cluster.options.mouseoverHandler\r\n    this.mousemove = cluster.options.mousemoveHandler\r\n    this.zoomOnClick = cluster.options.zoomOnClick\r\n    this.clickHandler = this.clickHandler.bind(this)\r\n    this.mousemoveHandler = this.mousemoveHandler.bind(this)\r\n    this.zoomstartHandler = this.zoomstartHandler.bind(this)\r\n    this.initEvent()\r\n  }\r\n  initEvent() {\r\n    this.map.on('click', this.clickHandler)\r\n    this.map.on('mousemove', this.mousemoveHandler)\r\n    this.map.on('zoomstart', this.zoomstartHandler)\r\n  }\r\n  off() {\r\n    this.map.off('click', this.clickHandler)\r\n    this.map.off('mousemove', this.mousemoveHandler)\r\n    this.map.off('zoomstart', this.zoomstartHandler)\r\n  }\r\n  clickHandler(event) {\r\n    const {pixel} = event\r\n    const point = this.findPoint(pixel)\r\n    if (point) {\r\n      const params = this.cluster.getParams(point)\r\n      // 触发 `mouseout`\r\n      this.mouseoutHandler(point)\r\n      // 点击聚合点展开聚合\r\n      this.zoomOnClick && params.isCluster && this.zoomOnClickHandler(point)\r\n      this.cluster.isFunction(this.click) && this.click(params)\r\n    }\r\n  }\r\n  // 由`mousemove`衍生出 `mouseout` & `mouseover`\r\n  mousemoveHandler(event) {\r\n    const {pixel} = event\r\n    const hoverPoint = this.hoverPoint\r\n    const point = this.findPoint(pixel)\r\n    // 先触发 mouseout 事件\r\n    if (hoverPoint && !this.constains(hoverPoint, pixel)) {\r\n      this.mouseoutHandler()\r\n    }\r\n    // 后触发 mouseover 事件\r\n    if (point && hoverPoint !== point) {\r\n      this.mouseoverHandler(point)\r\n    }\r\n    this.cluster.isFunction(this.mousemove) && this.mousemove(event, point)\r\n  }\r\n  mouseoverHandler(point) {\r\n    this.hoverPoint = point\r\n    const params = this.cluster.getParams(point)\r\n    this.cluster.renderHoverPoint(params)\r\n    this.cluster.isFunction(this.mouseover) && this.mouseover(params)\r\n  }\r\n  mouseoutHandler() {\r\n    this.hoverPoint = null\r\n    this.cluster.clearHoverPoint()\r\n    this.cluster.isFunction(this.mouseout) &&\r\n      this.mouseout(this.cluster.getParams(this.hoverPoint))\r\n  }\r\n  zoomstartHandler() {\r\n    this.mouseoutHandler()\r\n  }\r\n  zoomOnClickHandler(point) {\r\n    const {\r\n      renderPixel: {x, y},\r\n    } = point\r\n    const pixel = new AMap.Pixel(x, y)\r\n    const lnglat = this.map.containerToLngLat(pixel)\r\n    this.map.setCenter(lnglat)\r\n    this.map.zoomIn()\r\n  }\r\n  // 查找鼠标下面的点，因为聚合点跟实体点的大小可能不一致，所以要分开查找\r\n  findPoint(eventPixel) {\r\n    const data = this.cluster.getPoints()\r\n    const {length} = data\r\n    for (let i = 0; i < length; i++) {\r\n      const point = data[i]\r\n      if (this.constains(point, eventPixel)) {\r\n        return point\r\n      }\r\n    }\r\n    return null\r\n  }\r\n  // pixel 坐标是否在 point 范围内\r\n  constains(point, pixel) {\r\n    const params = this.cluster.getParams(point)\r\n    const {\r\n      offset: [offsetX, offsetY],\r\n      style: {width, height},\r\n    } = params\r\n    const {\r\n      renderPixel: {x: x1, y: y1},\r\n    } = point\r\n    const {x: x2, y: y2} = pixel\r\n    return (\r\n      x2 >= x1 + offsetX &&\r\n      x2 <= x1 + width + offsetX &&\r\n      y2 >= y1 + offsetY &&\r\n      y2 <= y1 + height + offsetY\r\n    )\r\n  }\r\n}\r\n","import Canvas from './canvas'\r\nimport ClusterItem from './clusterItem'\r\nimport AmapCoordinate from './amap.coordinate'\r\nimport MercatorCoordinate from './mercator.coordinate'\r\nimport Event from './event'\r\nimport {getOffset} from './utils'\r\n\r\n// 开发环境输出日志\r\nconst debug = process.env.NODE_ENV === 'development'\r\n\r\n// 聚合策略\r\nexport const Coordinate = {\r\n  MERCATOR: 'MERCATOR', // 使用 墨卡托 坐标系\r\n  AMAP: 'AMAP', // 使用高德地图容器的相对坐标\r\n}\r\n\r\n// 默认的点样式\r\nconst defaultStyle = {\r\n  width: 60,\r\n  height: 69,\r\n}\r\n// 聚合默认设置\r\nconst defaultOptions = {\r\n  data: null, // 数据集\r\n  coordinate: Coordinate.AMAP, // 聚合策略\r\n  maxZoom: 18, // 最大的聚合级别，大于该级别就不进行相应的聚合\r\n  gridSize: 60, // 聚合计算时，网格的像素大小\r\n  minClusterSize: 2, // 聚合的最小数量，小于该数量个点则不能成为一个聚合\r\n  averageCenter: true, // 是否取所有点的平均值作为聚合点中心\r\n  zoomOnClick: true, // 点击聚合点时，是否展开聚合\r\n  zIndex: 120, // canvas图层的zindex\r\n  visible: true, // 是否显示\r\n  offset: null, // 绘制图形相对于定位点的偏移度\r\n  getPosition(item) {\r\n    // 获取经纬度信息\r\n    const {location} = item\r\n    const {longitude, latitude} = location || {}\r\n    return longitude && latitude ? [longitude, latitude] : null\r\n  },\r\n  render: null, // 绘制函数\r\n  hoverRender: null, // hover状态下的绘制函数\r\n  // 以下参数主要用于事件系统\r\n  clickHandler: null, // click事件\r\n  mouseoutHandler: null, // mouseout事件\r\n  mouseoverHandler: null, // mouseover事件\r\n  mousemoveHandler: null, // mousemove事件\r\n  normalPointStyle: defaultStyle, // 实体点的样式\r\n  clusterPointStyle: defaultStyle, // 聚合点的样式\r\n  hoverNormalPointStyle: defaultStyle, // hover状态下实体点的样式\r\n  hoverClusterPointStyle: defaultStyle, // hover状态下聚合点的样式\r\n}\r\n\r\nexport default class Cluster {\r\n  constructor(options) {\r\n    this.data = null\r\n    this.points = []\r\n    this.renderData = null\r\n    this.clusterItems = null\r\n    this.options = Object.assign({}, defaultOptions, options)\r\n    // 解除 data 引用\r\n    this.options.data = null\r\n    this.normalOffset = getOffset(this.options.normalPointStyle, options.offset)\r\n    this.clusterOffset = getOffset(\r\n      this.options.clusterPointStyle,\r\n      options.offset\r\n    )\r\n    this.eventEngine = new Event(this)\r\n    this.renderEngine = new Canvas({\r\n      map: this.options.map,\r\n      zIndex: this.options.zIndex,\r\n      visible: this.options.visible,\r\n      render: this.build.bind(this),\r\n    })\r\n    this.coordinateEngine =\r\n      this.options.coordinate === Coordinate.AMAP\r\n        ? new AmapCoordinate(this.options)\r\n        : new MercatorCoordinate(this.options)\r\n    this.setData(options.data, false)\r\n  }\r\n  setData(data, rebuild = true) {\r\n    const {\r\n      options: {getPosition},\r\n    } = this\r\n    this.data = []\r\n    if (data) {\r\n      data.forEach(item => {\r\n        const position = getPosition(item)\r\n        if (position) {\r\n          item.position = position\r\n          this.data.push(item)\r\n        }\r\n      })\r\n    }\r\n    if (rebuild) {\r\n      this.build()\r\n    }\r\n  }\r\n  build() {\r\n    if (debug) {\r\n      console.time('聚合构建时间：')\r\n    }\r\n    this.buildCusterItem()\r\n    this.updatePoints()\r\n    this.render()\r\n    if (debug) {\r\n      console.timeEnd('聚合构建时间：')\r\n      console.log('%c构建聚合模块数量：' + this.points.length, 'color: red')\r\n    }\r\n  }\r\n  buildCusterItem() {\r\n    const options = {\r\n      coordinateEngine: this.coordinateEngine,\r\n      averageCenter: this.options.averageCenter,\r\n    }\r\n    this.clusterItems = []\r\n    this.renderData = this.coordinateEngine.getRenderData(this.data)\r\n    this.renderData.forEach(point => {\r\n      let parent = null\r\n      let distance = -1 // 当前点与聚合中心的距离\r\n      const {\r\n        coordinate: {x: pointX, y: pointY},\r\n      } = point\r\n      this.clusterItems.forEach(clusterItem => {\r\n        if (clusterItem.contains(point)) {\r\n          const {\r\n            coordinate: {x: centerX, y: centerY},\r\n          } = clusterItem\r\n          const currDistance =\r\n            Math.pow(pointX - centerX, 2) + Math.pow(pointY - centerY, 2)\r\n          if (distance < 0 || distance > currDistance) {\r\n            // 取距离最近的一个聚合\r\n            parent = clusterItem\r\n            distance = currDistance\r\n          }\r\n        }\r\n      })\r\n      if (parent) {\r\n        // 该点找到聚合对象\r\n        parent.addPoint(point)\r\n      } else {\r\n        // 以该点为中心创建一个聚合对象\r\n        const clusterItem = new ClusterItem(point, options)\r\n        this.clusterItems.push(clusterItem)\r\n      }\r\n    })\r\n  }\r\n  updatePoints() {\r\n    const {\r\n      clusterItems,\r\n      options: {map, minClusterSize, maxZoom},\r\n    } = this\r\n    if (map.getZoom() >= maxZoom) {\r\n      // 地图放大最大层级，就不存在聚合点了\r\n      this.points = clusterItems.reduce(\r\n        (pre, curr) => pre.concat(curr.points),\r\n        []\r\n      )\r\n    } else {\r\n      // 返回的点数据应该是聚合点+实体点\r\n      let points = []\r\n      clusterItems.forEach(clusterItem => {\r\n        if (clusterItem.getCount() >= minClusterSize) {\r\n          // 聚合点\r\n          points.push(clusterItem)\r\n        } else {\r\n          // 实体点\r\n          points = points.concat(clusterItem.points)\r\n        }\r\n      })\r\n      this.points = points\r\n    }\r\n  }\r\n  renderLater(delay) {\r\n    if (!this.renderTimer) {\r\n      this.renderTimer = setTimeout(this.render.bind(this), delay || 50)\r\n    }\r\n  }\r\n  render() {\r\n    const {\r\n      points,\r\n      options: {render},\r\n      renderEngine: {pixelRatio, clusterCanvasCxt},\r\n    } = this\r\n    if (!this.isFunction(render)) {\r\n      return\r\n    }\r\n    if (this.renderTimer) {\r\n      clearTimeout(this.renderTimer)\r\n      this.renderTimer = null\r\n    }\r\n    if (debug) {\r\n      console.time('绘制时间：')\r\n    }\r\n    // 清理画布\r\n    this.clearCluster()\r\n    // 绘制\r\n    points.forEach((point, index) => {\r\n      const params = this.getParams(point)\r\n      params.index = index\r\n      // 定位到中心位置\r\n      render(\r\n        clusterCanvasCxt,\r\n        point.renderPixel.x * pixelRatio,\r\n        point.renderPixel.y * pixelRatio,\r\n        params.style.width,\r\n        params.style.height,\r\n        params,\r\n        points\r\n      )\r\n    })\r\n    if (debug) {\r\n      console.timeEnd('绘制时间：')\r\n    }\r\n  }\r\n  renderHoverPoint(params) {\r\n    if (this.isFunction(this.options.hoverRender)) {\r\n      const {\r\n        isCluster,\r\n        data: {\r\n          renderPixel: {x, y},\r\n        },\r\n      } = params\r\n      const {\r\n        renderEngine,\r\n        renderEngine: {hoverCanvasCtx},\r\n        options: {hoverRender, hoverNormalPointStyle, hoverClusterPointStyle},\r\n      } = this\r\n      const style = isCluster ? hoverClusterPointStyle : hoverNormalPointStyle\r\n      const {width, height} = style\r\n      const pixelRatio = renderEngine.getPixelRatio()\r\n      const canvasLeft = x * pixelRatio\r\n      const canvasTop = y * pixelRatio\r\n      hoverRender(hoverCanvasCtx, canvasLeft, canvasTop, width, height, params)\r\n    }\r\n  }\r\n  // 清除聚合\r\n  clearCluster() {\r\n    const {\r\n      renderEngine,\r\n      renderEngine: {clusterCanvas},\r\n      options: {map},\r\n    } = this\r\n    const {width, height} = map.getSize()\r\n    renderEngine.setCanvasSize(clusterCanvas, width, height)\r\n  }\r\n  // 清除 hover 点\r\n  clearHoverPoint() {\r\n    const {\r\n      renderEngine,\r\n      renderEngine: {hoverCanvas},\r\n      options: {map},\r\n    } = this\r\n    const {width, height} = map.getSize()\r\n    renderEngine.setCanvasSize(hoverCanvas, width, height)\r\n  }\r\n  getPoints() {\r\n    return this.points\r\n  }\r\n  getParams(point) {\r\n    let offset = this.normalOffset\r\n    let style = this.options.normalPointStyle\r\n    const isCluster = this.isCluster(point)\r\n\r\n    if (isCluster) {\r\n      offset = this.clusterOffset\r\n      style = this.options.clusterPointStyle\r\n    }\r\n    return {\r\n      isCluster,\r\n      offset,\r\n      style,\r\n      data: point,\r\n    }\r\n  }\r\n  isCluster(point) {\r\n    return point instanceof ClusterItem\r\n  }\r\n  isFunction(fn) {\r\n    return typeof fn === 'function'\r\n  }\r\n  destroy() {\r\n    clearTimeout(this.renderTimer)\r\n    this.eventEngine.off()\r\n    this.renderEngine.layer.hide()\r\n    this.data = null\r\n    this.points = null\r\n    this.renderData = null\r\n    this.clusterItems = null\r\n  }\r\n}\r\n","// import Cluster from './lib/cluster'\r\nimport Cluster, { Coordinate } from '../src/cluster'\r\n\r\nfunction drawCircle( ctx, x, y, r, color = 'red' ) {\r\n  ctx.fillStyle = color\r\n  ctx.beginPath()\r\n  ctx.arc( x, y, r, 0, Math.PI * 2 )\r\n  ctx.fill()\r\n}\r\n\r\nfunction drawText( ctx, x, y, text, color = 'white' ) {\r\n  ctx.font = '18px SimHei'\r\n  ctx.textAlign = 'center'\r\n  ctx.textBaseline = 'middle'\r\n  ctx.fillStyle = color\r\n  ctx.fillText( text, x, y )\r\n}\r\n\r\nfunction random( basic, offset ) {\r\n  let change = Math.random() * offset\r\n  change = Math.random() > 0.5 ? change : -change\r\n  return basic + change\r\n}\r\n\r\nconst data = []\r\nconst longitude = 117.000923\r\nconst latitude = 36.675807\r\nfor ( let i = 0; i < 1000; i++ ) {\r\n  data.push( [random( longitude, 5 ), random( latitude, 5 )] )\r\n}\r\n\r\nfunction initCanvasCluster( options ) {\r\n  // `cluster` 依赖 `AMap.CustomLayer`\r\n  AMap.plugin( 'AMap.CustomLayer', function() {\r\n    const cluster = new Cluster( {\r\n      data,\r\n      gridSize: 80,\r\n      map: options.map,\r\n      type: options.type,\r\n      averageCenter: true,\r\n      offset: ['-50%', '-100%'],\r\n      normalPointStyle: {\r\n        width: 30,\r\n        height: 30\r\n      },\r\n      clusterPointStyle: {\r\n        width: 60,\r\n        height: 60\r\n      },\r\n      hoverNormalPointStyle: {\r\n        width: 30,\r\n        height: 30\r\n      },\r\n      hoverClusterPointStyle: {\r\n        width: 60,\r\n        height: 60\r\n      },\r\n      getPosition: item => item,\r\n      mousemoveHandler( event, data ) {\r\n        // console.log( 'mousemove: ', {event,data} )\r\n      },\r\n      mouseoutHandler( data ) {\r\n        // console.log( 'mouseout: ', data )\r\n      },\r\n      mouseoverHandler( data ) {\r\n        // console.log( 'mouseover: ', data )\r\n      },\r\n      render( ctx, x, y, width, height, point ) {\r\n        /**\r\n         * 因为绘制圆，`定位点` 是作为圆心，所以默认相当于偏于了 [-50%,-50%]；\r\n         * 要把图形绘制到 `定位点` 上方，还需要再 Y 轴上面添加 -50% 的偏移度\r\n         * offset: [-50%, -100%] 就完成了 `定位点` 在图形正下方\r\n         */\r\n        const { isCluster, data } = point\r\n        const r = width / 2\r\n        const centerX = x\r\n        const centerY = y - r - 3\r\n        if ( isCluster ) {\r\n          drawCircle( ctx, centerX, centerY, r )\r\n          drawText( ctx, centerX, centerY, data.getCount() )\r\n          // 定位点\r\n          drawCircle( ctx, x, y, 3, 'green' )\r\n        } else {\r\n          drawCircle( ctx, centerX, centerY, r, 'green' )\r\n        }\r\n      },\r\n      hoverRender( ctx, x, y, width, height, point ) {\r\n        const { isCluster, data } = point\r\n        const r = width / 2\r\n        const centerX = x\r\n        const centerY = y - r - 3\r\n        if ( isCluster ) {\r\n          drawCircle( ctx, centerX, centerY, r, 'white' )\r\n          drawText( ctx, centerX, centerY, data.getCount(), 'red' )\r\n        } else {\r\n          drawCircle( ctx, centerX, centerY, r, 'blue' )\r\n        }\r\n      }\r\n    } )\r\n    window.cluster = cluster\r\n  } )\r\n}\r\nfunction initAmapCluster( map ) {\r\n  const markers = data.map(\r\n    item =>\r\n      new AMap.Marker( {\r\n        position: item\r\n      } )\r\n  )\r\n  /*eslint-disable*/\r\n  new AMap.MarkerClusterer(map, markers, {\r\n    gridSize: 60,\r\n  })\r\n}\r\nconst amapMap = new AMap.Map('amap', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\nconst mercatorMap = new AMap.Map('mercator', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\nconst markerMap = new AMap.Map('marker', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\ninitCanvasCluster({\r\n  map: amapMap,\r\n  type: Coordinate.AMAP,\r\n})\r\n// initCanvasCluster({\r\n//   map: mercatorMap,\r\n//   type: Coordinate.MERCATOR,\r\n// })\r\n// initAmapCluster(markerMap)\r\n"],"names":["Canvas","options","layer","hoverCanvas","hoverCanvasCtx","clusterCanvas","clusterCanvasCxt","pixelRatio","getPixelRatio","init","map","visible","zIndex","render","container","document","createElement","style","position","appendChild","getContext","AMap","CustomLayer","zooms","Math","min","round","window","devicePixelRatio","canvas","w","h","width","height","ClusterItem","point","renderPixel","points","coordinate","averageCenter","coordinateEngine","length","centerX","x","centerY","y","newAddPoint","pointX","pointY","totalX","totalY","newCenterX","newCenterY","coordinateToPixel","centerPoint","push","updateCenter","gridSize","getGridSize","AmapCoordinate","data","renderData","bounds","getBounds","forEach","item","contains","lngLatToContainer","lonLat2Mercator","lonLat","longitude","latitude","log","tan","PI","mercator2LonLat","pixel","atan","exp","getOffsetValue","value","offset","type","_offset","trim","substr","Number","parseFloat","getOffset","Array","isArray","MercatorCoordinate","pow","getZoom","getExtendedBounds","southWest","getSouthWest","northEast","getNorthEast","tr","lng","lat","bl","Event","cluster","hoverPoint","click","clickHandler","mouseout","mouseoutHandler","mouseover","mouseoverHandler","mousemove","mousemoveHandler","zoomOnClick","bind","zoomstartHandler","initEvent","on","off","event","findPoint","params","getParams","isCluster","zoomOnClickHandler","isFunction","constains","renderHoverPoint","clearHoverPoint","Pixel","lnglat","containerToLngLat","setCenter","zoomIn","eventPixel","getPoints","i","offsetX","offsetY","x1","y1","x2","y2","Coordinate","MERCATOR","AMAP","defaultStyle","defaultOptions","maxZoom","minClusterSize","getPosition","location","hoverRender","normalPointStyle","clusterPointStyle","hoverNormalPointStyle","hoverClusterPointStyle","Cluster","clusterItems","Object","assign","normalOffset","clusterOffset","eventEngine","renderEngine","build","setData","rebuild","console","time","buildCusterItem","updatePoints","timeEnd","getRenderData","parent","distance","clusterItem","currDistance","addPoint","reduce","pre","curr","concat","getCount","delay","renderTimer","setTimeout","clearTimeout","clearCluster","index","canvasLeft","canvasTop","getSize","setCanvasSize","fn","hide","drawCircle","ctx","r","color","fillStyle","beginPath","arc","fill","drawText","text","font","textAlign","textBaseline","fillText","random","basic","change","initCanvasCluster","plugin","amapMap","Map","zoom","center","mercatorMap","markerMap"],"mappings":"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"}