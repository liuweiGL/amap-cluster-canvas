{"version":3,"file":"amap-cluster-canvas.test.js","sources":["../src/canvas.js","../src/clusterItem.js","../src/amap.coordinate.js","../src/utils.js","../src/mercator.coordinate.js","../src/event.js","../src/cluster.js","../test/index.js"],"sourcesContent":["/**\r\n * 为点聚合提供画布\r\n * @param options\r\n * {\r\n *   map: 地图,\r\n *   zIndex: 图层zIndex,\r\n *   visible: 是否可见\r\n * }\r\n */\r\nclass Canvas {\r\n  constructor( options ) {\r\n    this.layer = null\r\n    this.hoverCanvas = null\r\n    this.hoverCanvasCtx = null\r\n    this.clusterCanvas = null\r\n    this.clusterCanvasCxt = null\r\n    this.options = options\r\n    this.pixelRatio = this.getPixelRatio()\r\n    this.init()\r\n  }\r\n  init() {\r\n    const {\r\n      options: { map, visible, zIndex, render }\r\n    } = this\r\n    const container = document.createElement( 'div' )\r\n    // 绘制聚合点\r\n    const clusterCanvas = document.createElement( 'canvas' )\r\n    clusterCanvas.style.position = 'absolute'\r\n    // hover状态下的点绘制\r\n    const hoverCanvas = document.createElement( 'canvas' )\r\n    hoverCanvas.style.position = 'absolute'\r\n    container.appendChild( clusterCanvas )\r\n    container.appendChild( hoverCanvas )\r\n    this.clusterCanvas = clusterCanvas\r\n    this.hoverCanvas = hoverCanvas\r\n    this.clusterCanvasCxt = clusterCanvas.getContext( '2d' )\r\n    this.hoverCanvasCtx = hoverCanvas.getContext( '2d' )\r\n\r\n    this.layer = new AMap.CustomLayer( container, {\r\n      map,\r\n      zIndex,\r\n      visible,\r\n      zooms: [1, 20]\r\n    } )\r\n    this.layer.render = render\r\n  }\r\n  // 设备像素比\r\n  getPixelRatio() {\r\n    return Math.min( 2, Math.round( window.devicePixelRatio || 1 ) )\r\n  }\r\n  // 设置canvas的width&height属性可以清理画布\r\n  setCanvasSize( canvas, w, h ) {\r\n    const { pixelRatio } = this\r\n    canvas.width = w * pixelRatio\r\n    canvas.height = h * pixelRatio\r\n    canvas.style.width = w + 'px'\r\n    canvas.style.height = h + 'px'\r\n  }\r\n}\r\n\r\nexport default Canvas\r\n","class ClusterItem {\r\n  constructor( point, options ) {\r\n    this.renderPixel = null\r\n    this.points = [point]\r\n    this.coordinate = point.coordinate\r\n    this.averageCenter = options.averageCenter\r\n    this.coordinateEngine = options.coordinateEngine\r\n  }\r\n  getCount() {\r\n    return this.points.length\r\n  }\r\n  // 更新聚合点的中心点\r\n  updateCenter() {\r\n    const {\r\n      averageCenter,\r\n      points,\r\n      points: { length },\r\n      coordinate: { x: centerX, y: centerY }\r\n    } = this\r\n    if ( averageCenter ) {\r\n      const newAddPoint = points[length - 1]\r\n      const {\r\n        coordinate: { x: pointX, y: pointY }\r\n      } = newAddPoint\r\n      const totalX = centerX * ( length - 1 )\r\n      const totalY = centerY * ( length - 1 )\r\n      const newCenterX = ( totalX + pointX ) / length\r\n      const newCenterY = ( totalY + pointY ) / length\r\n      this.coordinate = {\r\n        x: newCenterX,\r\n        y: newCenterY\r\n      }\r\n      this.renderPixel = this.coordinateEngine.coordinateToPixel( this )\r\n    } else {\r\n      const centerPoint = this.points[0]\r\n      this.coordinate = centerPoint.coordinate\r\n      this.renderPixel = centerPoint.renderPixel\r\n    }\r\n  }\r\n  // 往聚合中添加点\r\n  addPoint( point ) {\r\n    this.points.push( point )\r\n    this.updateCenter()\r\n  }\r\n  // 判断一个点是否在改聚合范围内\r\n  contains( point ) {\r\n    const {\r\n      coordinate: { x: pointX, y: pointY }\r\n    } = point\r\n    const {\r\n      coordinate: { x: centerX, y: centerY }\r\n    } = this\r\n    const gridSize = this.coordinateEngine.getGridSize()\r\n    return (\r\n      pointX >= centerX - gridSize &&\r\n      pointX <= centerX + gridSize &&\r\n      pointY >= centerY - gridSize &&\r\n      pointY <= centerY + gridSize\r\n    )\r\n  }\r\n}\r\n\r\nexport default ClusterItem\r\n","export default class AmapCoordinate {\r\n  constructor( options ) {\r\n    this.map = options.map\r\n    this.gridSize = options.gridSize\r\n  }\r\n  getGridSize() {\r\n    return this.gridSize\r\n  }\r\n  getRenderData( data ) {\r\n    const renderData = []\r\n    const bounds = this.map.getBounds()\r\n    data.forEach( item => {\r\n      if ( bounds.contains( item.position ) ) {\r\n        // 经纬度转换为相对于地图容器的坐标\r\n        const coordinate = this.map.lngLatToContainer( item.position )\r\n        renderData.push( {\r\n          ...item,\r\n          coordinate,\r\n          renderPixel: coordinate\r\n        } )\r\n      }\r\n    } )\r\n    return renderData\r\n  }\r\n  coordinateToPixel( point ) {\r\n    return point.coordinate\r\n  }\r\n}\r\n","// 经纬度转墨卡托\r\nexport function lonLat2Mercator( lonLat ) {\r\n  const [longitude, latitude] = lonLat\r\n  let x = ( longitude * 20037508.34 ) / 180\r\n  let y =\r\n    Math.log( Math.tan( ( ( 90 + latitude ) * Math.PI ) / 360 ) ) / ( Math.PI / 180 )\r\n  y = ( y * 20037508.34 ) / 180\r\n  return {\r\n    x,\r\n    y\r\n  }\r\n}\r\n// 墨卡托转经纬度\r\nexport function mercator2LonLat( pixel ) {\r\n  const { x, y } = pixel\r\n  let longitude = ( x / 20037508.34 ) * 180\r\n  let latitude = ( y / 20037508.34 ) * 180\r\n  latitude =\r\n    ( 180 / Math.PI ) *\r\n    ( 2 * Math.atan( Math.exp( ( latitude * Math.PI ) / 180 ) ) - Math.PI / 2 )\r\n\r\n  return [longitude, latitude]\r\n}\r\n/**\r\n * 获取 offset 的值\r\n * @param {number} value\r\n * @param {any} offset\r\n * 1. offset 纯数字\r\n * 2. offset 百分比\r\n * 3. 默认返回 Number.parseFloat 的值\r\n */\r\nfunction getOffsetValue( value, offset ) {\r\n  const type = typeof offset\r\n  switch ( type ) {\r\n    case 'number':\r\n      return offset\r\n    case 'string':\r\n      const _offset = offset.trim()\r\n      if ( _offset.substr( -1 ) === '%' ) {\r\n        return value * ( Number.parseFloat( offset ) / 100 )\r\n      }\r\n      return Number.parseFloat( offset )\r\n    default:\r\n      return Number.parseFloat( offset )\r\n  }\r\n}\r\n// 解析 offset 参数\r\nexport function getOffset( style, offset ) {\r\n  if ( !Array.isArray( offset ) ) {\r\n    return [0, 0]\r\n  }\r\n  const { width, height } = style\r\n  return [getOffsetValue( width, offset[0] ), getOffsetValue( height, offset[1] )]\r\n}\r\n","import { lonLat2Mercator, mercator2LonLat } from './utils'\r\n\r\nexport default class MercatorCoordinate {\r\n  constructor( options ) {\r\n    this.map = options.map\r\n    this.gridSize = options.gridSize\r\n  }\r\n  getGridSize() {\r\n    return this.gridSize * Math.pow( 2, 18 - this.map.getZoom() )\r\n  }\r\n  getRenderData( data ) {\r\n    const renderData = []\r\n    const bounds = this.getExtendedBounds()\r\n    data.forEach( item => {\r\n      let { coordinate, renderPixel } = item\r\n      if ( !coordinate ) {\r\n        coordinate = lonLat2Mercator( item.position )\r\n        renderPixel = this.coordinateToPixel( item )\r\n      }\r\n      if ( this.contains( bounds, coordinate ) ) {\r\n        renderData.push( {\r\n          ...item,\r\n          coordinate,\r\n          renderPixel\r\n        } )\r\n      }\r\n    } )\r\n    return renderData\r\n  }\r\n  getExtendedBounds() {\r\n    const gridSize = this.getGridSize()\r\n    const bounds = this.map.getBounds()\r\n    const southWest = bounds.getSouthWest()\r\n    const northEast = bounds.getNorthEast()\r\n    // 上右\r\n    const tr = lonLat2Mercator( [southWest.lng, southWest.lat] )\r\n    // 下左\r\n    const bl = lonLat2Mercator( [northEast.lng, northEast.lat] )\r\n    tr.x -= gridSize\r\n    tr.y -= gridSize\r\n    bl.x += gridSize\r\n    bl.y += gridSize\r\n    return [tr, bl]\r\n  }\r\n  coordinateToPixel( point ) {\r\n    return this.map.lngLatToContainer(\r\n      point.position || mercator2LonLat( point.coordinate )\r\n    )\r\n  }\r\n  contains( bounds, coordinate ) {\r\n    const [tr, bl] = bounds\r\n    const { x, y } = coordinate\r\n    // 小于等于0 ：地图缩放到最小，世界地图都在视图内\r\n    return bl.x <= 0 || ( x >= tr.x && x <= bl.x && y >= tr.y && y <= bl.y )\r\n  }\r\n}\r\n","export default class Event {\r\n  constructor( cluster ) {\r\n    this.hoverPoint = null\r\n    this.cluster = cluster\r\n    this.map = cluster.options.map\r\n    this.click = cluster.options.clickHandler\r\n    this.mouseout = cluster.options.mouseoutHandler\r\n    this.mouseover = cluster.options.mouseoverHandler\r\n    this.mousemove = cluster.options.mousemoveHandler\r\n    this.zoomOnClick = cluster.options.zoomOnClick\r\n    this.initEvent()\r\n  }\r\n  initEvent() {\r\n    this.map.on( 'click', this.clickHandler.bind( this ) )\r\n    this.map.on( 'mousemove', this.mousemoveHandler.bind( this ) )\r\n    this.map.on( 'zoomstart', this.zoomstartHandler.bind( this ) )\r\n  }\r\n  clickHandler( event ) {\r\n    const { pixel } = event\r\n    const point = this.findPoint( pixel )\r\n    if ( point ) {\r\n      const params = this.cluster.getParams( point )\r\n      // 触发 `mouseout`\r\n      this.mouseoutHandler( point )\r\n      // 点击聚合点展开聚合\r\n      this.zoomOnClick && params.isCluster && this.zoomOnClickHandler( point )\r\n      this.cluster.isFunction( this.click ) && this.click( params )\r\n    }\r\n  }\r\n  // 由`mousemove`衍生出 `mouseout` & `mouseover`\r\n  mousemoveHandler( event ) {\r\n    const { pixel } = event\r\n    const hoverPoint = this.hoverPoint\r\n    const point = this.findPoint( pixel )\r\n    // 先触发 mouseout 事件\r\n    if ( hoverPoint && !this.constains( hoverPoint, pixel ) ) {\r\n      this.mouseoutHandler()\r\n    }\r\n    // 后触发 mouseover 事件\r\n    if ( point && hoverPoint !== point ) {\r\n      this.mouseoverHandler( point )\r\n    }\r\n    this.cluster.isFunction( this.mousemove ) && this.mousemove( event, point )\r\n  }\r\n  mouseoverHandler( point ) {\r\n    this.hoverPoint = point\r\n    const params = this.cluster.getParams( point )\r\n    this.cluster.renderHoverPoint( params )\r\n    this.cluster.isFunction( this.mouseover ) && this.mouseover( params )\r\n  }\r\n  mouseoutHandler() {\r\n    this.hoverPoint = null\r\n    this.cluster.clearHoverPoint()\r\n    this.cluster.isFunction( this.mouseout ) &&\r\n      this.mouseout( this.cluster.getParams( this.hoverPoint ) )\r\n  }\r\n  zoomstartHandler() {\r\n    this.mouseoutHandler()\r\n  }\r\n  zoomOnClickHandler( point ) {\r\n    const {\r\n      renderPixel: { x, y }\r\n    } = point\r\n    const pixel = new AMap.Pixel( x, y )\r\n    const lnglat = this.map.containerToLngLat( pixel )\r\n    this.map.setCenter( lnglat )\r\n    this.map.zoomIn()\r\n  }\r\n  // 查找鼠标下面的点，因为聚合点跟实体点的大小可能不一致，所以要分开查找\r\n  findPoint( eventPixel ) {\r\n    const data = this.cluster.getPoints()\r\n    const { length } = data\r\n    for ( let i = 0; i < length; i++ ) {\r\n      const point = data[i]\r\n      if ( this.constains( point, eventPixel ) ) {\r\n        return point\r\n      }\r\n    }\r\n    return null\r\n  }\r\n  // pixel 坐标是否在 point 范围内\r\n  constains( point, pixel ) {\r\n    const params = this.cluster.getParams( point )\r\n    const {\r\n      offset: [offsetX, offsetY],\r\n      style: { width, height }\r\n    } = params\r\n    const {\r\n      renderPixel: { x: x1, y: y1 }\r\n    } = point\r\n    const { x: x2, y: y2 } = pixel\r\n    return (\r\n      x2 >= x1 + offsetX &&\r\n      x2 <= x1 + width + offsetX &&\r\n      y2 >= y1 + offsetY &&\r\n      y2 <= y1 + height + offsetY\r\n    )\r\n  }\r\n}\r\n","import Canvas from './canvas'\r\nimport ClusterItem from './clusterItem'\r\nimport AmapCoordinate from './amap.coordinate'\r\nimport MercatorCoordinate from './mercator.coordinate'\r\nimport Event from './event'\r\nimport { getOffset } from './utils'\r\n\r\n// 开发环境输出日志\r\nconst debug = process.env.NODE_ENV === 'development'\r\n\r\n// 聚合策略\r\nexport const Coordinate = {\r\n  MERCATOR: 'MERCATOR', // 使用 墨卡托 坐标系\r\n  AMAP: 'AMAP' // 使用高德地图容器的相对坐标\r\n}\r\n\r\n// 默认的点样式\r\nconst defaultStyle = {\r\n  width: 60,\r\n  height: 69\r\n}\r\n// 聚合默认设置\r\nconst defaultOptions = {\r\n  data: null, // 数据集\r\n  coordinate: Coordinate.AMAP, // 聚合策略\r\n  maxZoom: 18, // 最大的聚合级别，大于该级别就不进行相应的聚合\r\n  gridSize: 60, // 聚合计算时，网格的像素大小\r\n  minClusterSize: 2, // 聚合的最小数量，小于该数量个点则不能成为一个聚合\r\n  averageCenter: true, // 是否取所有点的平均值作为聚合点中心\r\n  zoomOnClick: true, // 点击聚合点时，是否展开聚合\r\n  zIndex: 120, // canvas图层的zindex\r\n  visible: true, // 是否显示\r\n  offset: null, // 绘制图形相对于定位点的偏移度\r\n  getPosition( item ) {\r\n    // 获取经纬度信息\r\n    const { location } = item\r\n    const { longitude, latitude } = location || {}\r\n    return longitude && latitude ? [longitude, latitude] : null\r\n  },\r\n  render: null, // 绘制函数\r\n  hoverRender: null, // hover状态下的绘制函数\r\n  // 以下参数主要用于事件系统\r\n  clickHandler: null, // click事件\r\n  mouseoutHandler: null, // mouseout事件\r\n  mouseoverHandler: null, // mouseover事件\r\n  mousemoveHandler: null, // mousemove事件\r\n  normalPointStyle: defaultStyle, // 实体点的样式\r\n  clusterPointStyle: defaultStyle, // 聚合点的样式\r\n  hoverNormalPointStyle: defaultStyle, // hover状态下实体点的样式\r\n  hoverClusterPointStyle: defaultStyle // hover状态下聚合点的样式\r\n}\r\n\r\nexport default class Cluster {\r\n  constructor( options ) {\r\n    this.data = null\r\n    this.points = []\r\n    this.renderData = null\r\n    this.clusterItems = null\r\n    this.options = Object.assign( {}, defaultOptions, options )\r\n    // 解除 data 引用\r\n    this.options.data = null\r\n    this.normalOffset = getOffset( this.options.normalPointStyle, options.offset )\r\n    this.clusterOffset = getOffset(\r\n      this.options.clusterPointStyle,\r\n      options.offset\r\n    )\r\n    this.eventEngine = new Event( this )\r\n    this.renderEngine = new Canvas( {\r\n      map: this.options.map,\r\n      zIndex: this.options.zIndex,\r\n      visible: this.options.visible,\r\n      render: this.build.bind( this )\r\n    } )\r\n    this.coordinateEngine =\r\n      this.options.coordinate === Coordinate.AMAP\r\n        ? new AmapCoordinate( this.options )\r\n        : new MercatorCoordinate( this.options )\r\n    this.setData( options.data, false )\r\n  }\r\n  setData( data, rebuild = true ) {\r\n    const {\r\n      options: { getPosition }\r\n    } = this\r\n    this.data = []\r\n    if ( data ) {\r\n      data.forEach( item => {\r\n        const position = getPosition( item )\r\n        if ( position ) {\r\n          item.position = position\r\n          this.data.push( item )\r\n        }\r\n      } )\r\n    }\r\n    if ( rebuild ) {\r\n      this.build()\r\n    }\r\n  }\r\n  build() {\r\n    if ( debug ) {\r\n      console.time( '聚合构建时间：' )\r\n    }\r\n    this.buildCusterItem()\r\n    this.updatePoints()\r\n    this.render()\r\n    if ( debug ) {\r\n      console.timeEnd( '聚合构建时间：' )\r\n      console.log( '%c构建聚合模块数量：' + this.points.length, 'color: red' )\r\n    }\r\n  }\r\n  buildCusterItem() {\r\n    const options = {\r\n      coordinateEngine: this.coordinateEngine,\r\n      averageCenter: this.options.averageCenter\r\n    }\r\n    this.clusterItems = []\r\n    this.renderData = this.coordinateEngine.getRenderData( this.data )\r\n    this.renderData.forEach( point => {\r\n      let parent = null\r\n      let distance = -1 // 当前点与聚合中心的距离\r\n      const {\r\n        coordinate: { x: pointX, y: pointY }\r\n      } = point\r\n      this.clusterItems.forEach( clusterItem => {\r\n        if ( clusterItem.contains( point ) ) {\r\n          const {\r\n            coordinate: { x: centerX, y: centerY }\r\n          } = clusterItem\r\n          const currDistance =\r\n            Math.pow( pointX - centerX, 2 ) + Math.pow( pointY - centerY, 2 )\r\n          if ( distance < 0 || distance > currDistance ) {\r\n            // 取距离最近的一个聚合\r\n            parent = clusterItem\r\n            distance = currDistance\r\n          }\r\n        }\r\n      } )\r\n      if ( parent ) {\r\n        // 该点找到聚合对象\r\n        parent.addPoint( point )\r\n      } else {\r\n        // 以该点为中心创建一个聚合对象\r\n        const clusterItem = new ClusterItem( point, options )\r\n        this.clusterItems.push( clusterItem )\r\n      }\r\n    } )\r\n  }\r\n  updatePoints() {\r\n    const {\r\n      clusterItems,\r\n      options: { map, minClusterSize, maxZoom }\r\n    } = this\r\n    if ( map.getZoom() >= maxZoom ) {\r\n      // 地图放大最大层级，就不存在聚合点了\r\n      this.points = clusterItems.reduce(\r\n        ( pre, curr ) => pre.concat( curr.points ),\r\n        []\r\n      )\r\n    } else {\r\n      // 返回的点数据应该是聚合点+实体点\r\n      let points = []\r\n      clusterItems.forEach( clusterItem => {\r\n        if ( clusterItem.getCount() >= minClusterSize ) {\r\n          // 聚合点\r\n          points.push( clusterItem )\r\n        } else {\r\n          // 实体点\r\n          points = points.concat( clusterItem.points )\r\n        }\r\n      } )\r\n      this.points = points\r\n    }\r\n  }\r\n  renderLater( delay ) {\r\n    if ( !this.renderTimer ) {\r\n      this.renderTimer = setTimeout( this.render.bind( this ), delay || 50 )\r\n    }\r\n  }\r\n  render() {\r\n    const {\r\n      points,\r\n      options: { render },\r\n      renderEngine: { pixelRatio, clusterCanvasCxt }\r\n    } = this\r\n    if ( !this.isFunction( render ) ) {\r\n      return\r\n    }\r\n    if ( this.renderTimer ) {\r\n      clearTimeout( this.renderTimer )\r\n      this.renderTimer = null\r\n    }\r\n    if ( debug ) {\r\n      console.time( '绘制时间：' )\r\n    }\r\n    // 清理画布\r\n    this.clearCluster()\r\n    // 绘制\r\n    points.forEach( ( point, index ) => {\r\n      const params = this.getParams( point )\r\n      params.index = index\r\n      // 定位到中心位置\r\n      render(\r\n        clusterCanvasCxt,\r\n        point.renderPixel.x * pixelRatio,\r\n        point.renderPixel.y * pixelRatio,\r\n        params.style.width,\r\n        params.style.height,\r\n        params,\r\n        points\r\n      )\r\n    } )\r\n    if ( debug ) {\r\n      console.timeEnd( '绘制时间：' )\r\n    }\r\n  }\r\n  renderHoverPoint( params ) {\r\n    if ( this.isFunction( this.options.hoverRender ) ) {\r\n      const {\r\n        isCluster,\r\n        data: {\r\n          renderPixel: { x, y }\r\n        }\r\n      } = params\r\n      const {\r\n        renderEngine,\r\n        renderEngine: { hoverCanvasCtx },\r\n        options: { hoverRender, hoverNormalPointStyle, hoverClusterPointStyle }\r\n      } = this\r\n      const style = isCluster ? hoverClusterPointStyle : hoverNormalPointStyle\r\n      const { width, height } = style\r\n      const pixelRatio = renderEngine.getPixelRatio()\r\n      const canvasLeft = x * pixelRatio\r\n      const canvasTop = y * pixelRatio\r\n      hoverRender( hoverCanvasCtx, canvasLeft, canvasTop, width, height, params )\r\n    }\r\n  }\r\n  // 清除聚合\r\n  clearCluster() {\r\n    const {\r\n      renderEngine,\r\n      renderEngine: { clusterCanvas },\r\n      options: { map }\r\n    } = this\r\n    const { width, height } = map.getSize()\r\n    renderEngine.setCanvasSize( clusterCanvas, width, height )\r\n  }\r\n  // 清除 hover 点\r\n  clearHoverPoint() {\r\n    const {\r\n      renderEngine,\r\n      renderEngine: { hoverCanvas },\r\n      options: { map }\r\n    } = this\r\n    const { width, height } = map.getSize()\r\n    renderEngine.setCanvasSize( hoverCanvas, width, height )\r\n  }\r\n  getPoints() {\r\n    return this.points\r\n  }\r\n  getParams( point ) {\r\n    let offset = this.normalOffset\r\n    let style = this.options.normalPointStyle\r\n    const isCluster = this.isCluster( point )\r\n\r\n    if ( isCluster ) {\r\n      offset = this.clusterOffset\r\n      style = this.options.clusterPointStyle\r\n    }\r\n    return {\r\n      isCluster,\r\n      offset,\r\n      style,\r\n      data: point\r\n    }\r\n  }\r\n  isCluster( point ) {\r\n    return point instanceof ClusterItem\r\n  }\r\n  isFunction( fn ) {\r\n    return typeof fn === 'function'\r\n  }\r\n}\r\n","// import Cluster from './lib/cluster'\r\nimport Cluster, { Coordinate } from '../src/cluster'\r\n\r\nfunction drawCircle( ctx, x, y, r, color = 'red' ) {\r\n  ctx.fillStyle = color\r\n  ctx.beginPath()\r\n  ctx.arc( x, y, r, 0, Math.PI * 2 )\r\n  ctx.fill()\r\n}\r\n\r\nfunction drawText( ctx, x, y, text, color = 'white' ) {\r\n  ctx.font = '18px SimHei'\r\n  ctx.textAlign = 'center'\r\n  ctx.textBaseline = 'middle'\r\n  ctx.fillStyle = color\r\n  ctx.fillText( text, x, y )\r\n}\r\n\r\nfunction random( basic, offset ) {\r\n  let change = Math.random() * offset\r\n  change = Math.random() > 0.5 ? change : -change\r\n  return basic + change\r\n}\r\n\r\nconst data = []\r\nconst longitude = 117.000923\r\nconst latitude = 36.675807\r\nfor ( let i = 0; i < 1000; i++ ) {\r\n  data.push( [random( longitude, 5 ), random( latitude, 5 )] )\r\n}\r\n\r\nfunction initCanvasCluster( options ) {\r\n  // `cluster` 依赖 `AMap.CustomLayer`\r\n  AMap.plugin( 'AMap.CustomLayer', function() {\r\n    const cluster = new Cluster( {\r\n      data,\r\n      gridSize: 80,\r\n      map: options.map,\r\n      type: options.type,\r\n      averageCenter: true,\r\n      offset: ['-50%', '-100%'],\r\n      normalPointStyle: {\r\n        width: 30,\r\n        height: 30\r\n      },\r\n      clusterPointStyle: {\r\n        width: 60,\r\n        height: 60\r\n      },\r\n      hoverNormalPointStyle: {\r\n        width: 30,\r\n        height: 30\r\n      },\r\n      hoverClusterPointStyle: {\r\n        width: 60,\r\n        height: 60\r\n      },\r\n      getPosition: item => item,\r\n      mousemoveHandler( event, data ) {\r\n        // console.log( 'mousemove: ', {event,data} )\r\n      },\r\n      mouseoutHandler( data ) {\r\n        // console.log( 'mouseout: ', data )\r\n      },\r\n      mouseoverHandler( data ) {\r\n        // console.log( 'mouseover: ', data )\r\n      },\r\n      render( ctx, x, y, width, height, point ) {\r\n        /**\r\n         * 因为绘制圆，`定位点` 是作为圆心，所以默认相当于偏于了 [-50%,-50%]；\r\n         * 要把图形绘制到 `定位点` 上方，还需要再 Y 轴上面添加 -50% 的偏移度\r\n         * offset: [-50%, -100%] 就完成了 `定位点` 在图形正下方\r\n         */\r\n        const { isCluster, data } = point\r\n        const r = width / 2\r\n        const centerX = x\r\n        const centerY = y - r - 3\r\n        if ( isCluster ) {\r\n          drawCircle( ctx, centerX, centerY, r )\r\n          drawText( ctx, centerX, centerY, data.getCount() )\r\n          // 定位点\r\n          drawCircle( ctx, x, y, 3, 'green' )\r\n        } else {\r\n          drawCircle( ctx, centerX, centerY, r, 'green' )\r\n        }\r\n      },\r\n      hoverRender( ctx, x, y, width, height, point ) {\r\n        const { isCluster, data } = point\r\n        const r = width / 2\r\n        const centerX = x\r\n        const centerY = y - r - 3\r\n        if ( isCluster ) {\r\n          drawCircle( ctx, centerX, centerY, r, 'white' )\r\n          drawText( ctx, centerX, centerY, data.getCount(), 'red' )\r\n        } else {\r\n          drawCircle( ctx, centerX, centerY, r, 'blue' )\r\n        }\r\n      }\r\n    } )\r\n    window.cluster = cluster\r\n  } )\r\n}\r\nfunction initAmapCluster( map ) {\r\n  const markers = data.map(\r\n    item =>\r\n      new AMap.Marker( {\r\n        position: item\r\n      } )\r\n  )\r\n  /*eslint-disable*/\r\n  new AMap.MarkerClusterer(map, markers, {\r\n    gridSize: 60,\r\n  })\r\n}\r\nconst amapMap = new AMap.Map('amap', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\nconst mercatorMap = new AMap.Map('mercator', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\nconst markerMap = new AMap.Map('marker', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\ninitCanvasCluster({\r\n  map: amapMap,\r\n  type: Coordinate.AMAP,\r\n})\r\n// initCanvasCluster({\r\n//   map: mercatorMap,\r\n//   type: Coordinate.MERCATOR,\r\n// })\r\n// initAmapCluster(markerMap)\r\n"],"names":["Canvas","options","layer","hoverCanvas","hoverCanvasCtx","clusterCanvas","clusterCanvasCxt","pixelRatio","getPixelRatio","init","map","visible","zIndex","render","container","document","createElement","style","position","appendChild","getContext","AMap","CustomLayer","zooms","Math","min","round","window","devicePixelRatio","canvas","w","h","width","height","ClusterItem","point","renderPixel","points","coordinate","averageCenter","coordinateEngine","length","centerX","x","centerY","y","newAddPoint","pointX","pointY","totalX","totalY","newCenterX","newCenterY","coordinateToPixel","centerPoint","push","updateCenter","gridSize","getGridSize","AmapCoordinate","data","renderData","bounds","getBounds","forEach","item","contains","lngLatToContainer","lonLat2Mercator","lonLat","longitude","latitude","log","tan","PI","mercator2LonLat","pixel","atan","exp","getOffsetValue","value","offset","type","_offset","trim","substr","Number","parseFloat","getOffset","Array","isArray","MercatorCoordinate","pow","getZoom","getExtendedBounds","southWest","getSouthWest","northEast","getNorthEast","tr","lng","lat","bl","Event","cluster","hoverPoint","click","clickHandler","mouseout","mouseoutHandler","mouseover","mouseoverHandler","mousemove","mousemoveHandler","zoomOnClick","initEvent","on","bind","zoomstartHandler","event","findPoint","params","getParams","isCluster","zoomOnClickHandler","isFunction","constains","renderHoverPoint","clearHoverPoint","Pixel","lnglat","containerToLngLat","setCenter","zoomIn","eventPixel","getPoints","i","offsetX","offsetY","x1","y1","x2","y2","Coordinate","MERCATOR","AMAP","defaultStyle","defaultOptions","maxZoom","minClusterSize","getPosition","location","hoverRender","normalPointStyle","clusterPointStyle","hoverNormalPointStyle","hoverClusterPointStyle","Cluster","clusterItems","Object","assign","normalOffset","clusterOffset","eventEngine","renderEngine","build","setData","rebuild","console","time","buildCusterItem","updatePoints","timeEnd","getRenderData","parent","distance","clusterItem","currDistance","addPoint","reduce","pre","curr","concat","getCount","delay","renderTimer","setTimeout","clearTimeout","clearCluster","index","canvasLeft","canvasTop","getSize","setCanvasSize","fn","drawCircle","ctx","r","color","fillStyle","beginPath","arc","fill","drawText","text","font","textAlign","textBaseline","fillText","random","basic","change","initCanvasCluster","plugin","amapMap","Map","zoom","center","mercatorMap","markerMap"],"mappings":"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"}