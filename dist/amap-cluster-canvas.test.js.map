{"version":3,"file":"amap-cluster-canvas.test.js","sources":["../src/canvas.js","../src/clusterItem.js","../src/amap.coordinate.js","../src/utils.js","../src/mercator.coordinate.js","../src/event.js","../src/cluster.js","../test/index.js"],"sourcesContent":["/**\r\n * 为点聚合提供画布\r\n * @param options\r\n * {\r\n *   map: 地图,\r\n *   zIndex: 图层zIndex,\r\n *   visible: 是否可见\r\n * }\r\n */\r\nclass Canvas {\r\n  constructor( options ) {\r\n    this.layer = null\r\n    this.hoverCanvas = null\r\n    this.hoverCanvasCtx = null\r\n    this.clusterCanvas = null\r\n    this.clusterCanvasCxt = null\r\n    this.options = options\r\n    this.pixelRatio = this.getPixelRatio()\r\n    this.init()\r\n  }\r\n  init() {\r\n    const {\r\n      options: { map, visible, zIndex, render }\r\n    } = this\r\n    const container = document.createElement( 'div' )\r\n    // 绘制聚合点\r\n    const clusterCanvas = document.createElement( 'canvas' )\r\n    clusterCanvas.style.position = 'absolute'\r\n    // hover状态下的点绘制\r\n    const hoverCanvas = document.createElement( 'canvas' )\r\n    hoverCanvas.style.position = 'absolute'\r\n    container.appendChild( clusterCanvas )\r\n    container.appendChild( hoverCanvas )\r\n    this.clusterCanvas = clusterCanvas\r\n    this.hoverCanvas = hoverCanvas\r\n    this.clusterCanvasCxt = clusterCanvas.getContext( '2d' )\r\n    this.hoverCanvasCtx = hoverCanvas.getContext( '2d' )\r\n\r\n    this.layer = new AMap.CustomLayer( container, {\r\n      map,\r\n      zIndex,\r\n      visible,\r\n      zooms: [1, 20]\r\n    } )\r\n    this.layer.render = render\r\n  }\r\n  // 设备像素比\r\n  getPixelRatio() {\r\n    return Math.min( 2, Math.round( window.devicePixelRatio || 1 ) )\r\n  }\r\n  // 设置canvas的width&height属性可以清理画布\r\n  setCanvasSize( canvas, w, h ) {\r\n    const { pixelRatio } = this\r\n    canvas.width = w * pixelRatio\r\n    canvas.height = h * pixelRatio\r\n    canvas.style.width = w + 'px'\r\n    canvas.style.height = h + 'px'\r\n  }\r\n}\r\n\r\nexport default Canvas\r\n","class ClusterItem {\r\n  constructor( point, options ) {\r\n    this.renderPixel = null\r\n    this.points = [point]\r\n    this.coordinate = point.coordinate\r\n    this.averageCenter = options.averageCenter\r\n    this.coordinateEngine = options.coordinateEngine\r\n  }\r\n  getCount() {\r\n    return this.points.length\r\n  }\r\n  // 更新聚合点的中心点\r\n  updateCenter() {\r\n    const {\r\n      averageCenter,\r\n      points,\r\n      points: { length },\r\n      coordinate: { x: centerX, y: centerY }\r\n    } = this\r\n    if ( averageCenter ) {\r\n      const newAddPoint = points[length - 1]\r\n      const {\r\n        coordinate: { x: pointX, y: pointY }\r\n      } = newAddPoint\r\n      const totalX = centerX * ( length - 1 )\r\n      const totalY = centerY * ( length - 1 )\r\n      const newCenterX = ( totalX + pointX ) / length\r\n      const newCenterY = ( totalY + pointY ) / length\r\n      this.coordinate = {\r\n        x: newCenterX,\r\n        y: newCenterY\r\n      }\r\n      this.renderPixel = this.coordinateEngine.coordinateToPixel( this )\r\n    } else {\r\n      const centerPoint = this.points[0]\r\n      this.coordinate = centerPoint.coordinate\r\n      this.renderPixel = centerPoint.renderPixel\r\n    }\r\n  }\r\n  // 往聚合中添加点\r\n  addPoint( point ) {\r\n    this.points.push( point )\r\n    this.updateCenter()\r\n  }\r\n  // 判断一个点是否在改聚合范围内\r\n  contains( point ) {\r\n    const {\r\n      coordinate: { x: pointX, y: pointY }\r\n    } = point\r\n    const {\r\n      coordinate: { x: centerX, y: centerY }\r\n    } = this\r\n    const gridSize = this.coordinateEngine.getGridSize()\r\n    return (\r\n      pointX >= centerX - gridSize &&\r\n      pointX <= centerX + gridSize &&\r\n      pointY >= centerY - gridSize &&\r\n      pointY <= centerY + gridSize\r\n    )\r\n  }\r\n}\r\n\r\nexport default ClusterItem\r\n","export default class AmapCoordinate {\r\n  constructor( options ) {\r\n    this.map = options.map\r\n    this.gridSize = options.gridSize\r\n  }\r\n  getGridSize() {\r\n    return this.gridSize\r\n  }\r\n  getRenderData( data ) {\r\n    const renderData = []\r\n    const bounds = this.map.getBounds()\r\n    data.forEach( item => {\r\n      if ( bounds.contains( item.position ) ) {\r\n        // 经纬度转换为相对于地图容器的坐标\r\n        const coordinate = this.map.lngLatToContainer( item.position )\r\n        renderData.push( {\r\n          ...item,\r\n          coordinate,\r\n          renderPixel: coordinate\r\n        } )\r\n      }\r\n    } )\r\n    return renderData\r\n  }\r\n  coordinateToPixel( point ) {\r\n    return point.coordinate\r\n  }\r\n}\r\n","// 经纬度转墨卡托\r\nexport function lonLat2Mercator( lonLat ) {\r\n  const [longitude, latitude] = lonLat\r\n  let x = ( longitude * 20037508.34 ) / 180\r\n  let y =\r\n    Math.log( Math.tan( ( ( 90 + latitude ) * Math.PI ) / 360 ) ) / ( Math.PI / 180 )\r\n  y = ( y * 20037508.34 ) / 180\r\n  return {\r\n    x,\r\n    y\r\n  }\r\n}\r\n// 墨卡托转经纬度\r\nexport function mercator2LonLat( pixel ) {\r\n  const { x, y } = pixel\r\n  let longitude = ( x / 20037508.34 ) * 180\r\n  let latitude = ( y / 20037508.34 ) * 180\r\n  latitude =\r\n    ( 180 / Math.PI ) *\r\n    ( 2 * Math.atan( Math.exp( ( latitude * Math.PI ) / 180 ) ) - Math.PI / 2 )\r\n\r\n  return [longitude, latitude]\r\n}\r\n/**\r\n * 获取 offset 的值\r\n * @param {number} value\r\n * @param {any} offset\r\n * 1. offset 纯数字\r\n * 2. offset 百分比\r\n * 3. 默认返回 Number.parseFloat 的值\r\n */\r\nfunction getOffsetValue( value, offset ) {\r\n  const type = typeof offset\r\n  switch ( type ) {\r\n    case 'number':\r\n      return offset\r\n    case 'string':\r\n      const _offset = offset.trim()\r\n      if ( _offset.substr( -1 ) === '%' ) {\r\n        return value * ( Number.parseFloat( offset ) / 100 )\r\n      }\r\n      return Number.parseFloat( offset )\r\n    default:\r\n      return Number.parseFloat( offset )\r\n  }\r\n}\r\nexport function getOffset( style, offset ) {\r\n  if ( !Array.isArray( offset ) ) {\r\n    return style\r\n  }\r\n  const { width, height } = style\r\n  const widthOffset = getOffsetValue( width, offset[0] )\r\n  const heightOffset = getOffsetValue( height, offset[1] )\r\n  return {\r\n    width: [widthOffset, width + widthOffset],\r\n    height: [heightOffset, height + heightOffset]\r\n  }\r\n}\r\n","import { lonLat2Mercator, mercator2LonLat } from './utils'\r\n\r\nexport default class MercatorCoordinate {\r\n  constructor( options ) {\r\n    this.map = options.map\r\n    this.gridSize = options.gridSize\r\n  }\r\n  getGridSize() {\r\n    return this.gridSize * Math.pow( 2, 18 - this.map.getZoom() )\r\n  }\r\n  getRenderData( data ) {\r\n    const renderData = []\r\n    const bounds = this.getExtendedBounds()\r\n    data.forEach( item => {\r\n      let { coordinate, renderPixel } = item\r\n      if ( !coordinate ) {\r\n        coordinate = lonLat2Mercator( item.position )\r\n        renderPixel = this.coordinateToPixel( item )\r\n      }\r\n      if ( this.contains( bounds, coordinate ) ) {\r\n        renderData.push( {\r\n          ...item,\r\n          coordinate,\r\n          renderPixel\r\n        } )\r\n      }\r\n    } )\r\n    return renderData\r\n  }\r\n  getExtendedBounds() {\r\n    const gridSize = this.getGridSize()\r\n    const bounds = this.map.getBounds()\r\n    const southWest = bounds.getSouthWest()\r\n    const northEast = bounds.getNorthEast()\r\n    // 上右\r\n    const tr = lonLat2Mercator( [southWest.lng, southWest.lat] )\r\n    // 下左\r\n    const bl = lonLat2Mercator( [northEast.lng, northEast.lat] )\r\n    tr.x -= gridSize\r\n    tr.y -= gridSize\r\n    bl.x += gridSize\r\n    bl.y += gridSize\r\n    return [tr, bl]\r\n  }\r\n  coordinateToPixel( point ) {\r\n    return this.map.lngLatToContainer(\r\n      point.position || mercator2LonLat( point.coordinate )\r\n    )\r\n  }\r\n  contains( bounds, coordinate ) {\r\n    const [tr, bl] = bounds\r\n    const { x, y } = coordinate\r\n    // 小于等于0 ：地图缩放到最小，世界地图都在视图内\r\n    return bl.x <= 0 || ( x >= tr.x && x <= bl.x && y >= tr.y && y <= bl.y )\r\n  }\r\n}\r\n","import { getOffset } from './utils'\r\nexport default class Event {\r\n  constructor( cluster ) {\r\n    this.hoverPoint = null\r\n    this.zooming = false\r\n    this.cluster = cluster\r\n    this.map = cluster.options.map\r\n    this.click = cluster.options.clickHandler\r\n    this.mouseout = cluster.options.mouseoutHandler\r\n    this.mouseover = cluster.options.mouseoverHandler\r\n    this.mousemove = cluster.options.mousemoveHandler\r\n    this.zoomOnClick = cluster.options.zoomOnClick\r\n    this.normalOffset = getOffset(\r\n      cluster.options.normalPointStyle,\r\n      cluster.options.offset\r\n    )\r\n    this.clusterOffset = getOffset(\r\n      cluster.options.clusterPointStyle,\r\n      cluster.options.offset\r\n    )\r\n    this.initEvent()\r\n  }\r\n  initEvent() {\r\n    this.map.on( 'click', this.clickHandler.bind( this ) )\r\n    this.map.on( 'mousemove', this.mousemoveHandler.bind( this ) )\r\n    this.map.on( 'zoomstart', this.zoomstartHandler.bind( this ) )\r\n    this.map.on( 'zoomend', this.zoomendHandler.bind( this ) )\r\n  }\r\n  clickHandler( event ) {\r\n    const { pixel } = event\r\n    const point = this.findPoint( pixel )\r\n    if ( point ) {\r\n      const isCluster = this.cluster.isCluster( point )\r\n      const params = {\r\n        isCluster,\r\n        data: point\r\n      }\r\n      // 触发 `mouseout`\r\n      this.mouseoutHandler( point )\r\n      // 点击聚合点展开聚合\r\n      this.zoomOnClick && isCluster && this.zoomOnClickHandler( point )\r\n      this.cluster.isFunction( this.click ) && this.click( params )\r\n    }\r\n  }\r\n  // 由`mousemove`衍生出 `mouseout` & `mouseover`\r\n  mousemoveHandler( event ) {\r\n    const { pixel } = event\r\n    let point = this.hoverPoint\r\n\r\n    if ( !( !this.zooming && point && this.constains( point, pixel ) ) ) {\r\n      point = this.findPoint( pixel )\r\n      this.mouseoutHandler( point )\r\n      this.mouseoverHandler( point )\r\n    }\r\n    this.cluster.isFunction( this.mousemove ) && this.mousemove( event, point )\r\n  }\r\n  mouseoutHandler( point ) {\r\n    if ( this.hoverPoint ) {\r\n      this.cluster.clearHoverPoint()\r\n      this.cluster.isFunction( this.mouseout ) &&\r\n        this.mouseout( this.cluster.getParams( this.hoverPoint ) )\r\n    }\r\n    this.hoverPoint = point\r\n  }\r\n  mouseoverHandler( point ) {\r\n    if ( point ) {\r\n      const params = this.cluster.getParams( point )\r\n      this.cluster.renderHoverPoint( params )\r\n      this.cluster.isFunction( this.mouseover ) && this.mouseover( params )\r\n    }\r\n  }\r\n  zoomstartHandler() {\r\n    this.zooming = true\r\n    this.cluster.clearHoverPoint()\r\n  }\r\n  zoomendHandler() {\r\n    this.zooming = false\r\n    this.hoverPoint = null\r\n    this.cluster.clearHoverPoint()\r\n  }\r\n  zoomOnClickHandler( point ) {\r\n    const {\r\n      renderPixel: { x, y }\r\n    } = point\r\n    const pixel = new AMap.Pixel( x, y )\r\n    const lnglat = this.map.containerToLngLat( pixel )\r\n    this.map.setCenter( lnglat )\r\n    this.map.zoomIn()\r\n  }\r\n  // 查找鼠标下面的点，因为聚合点跟实体点的大小可能不一致，所以要分开查找\r\n  findPoint( eventPixel ) {\r\n    const data = this.cluster.getPoints()\r\n    const { length } = data\r\n    for ( let i = 0; i < length; i++ ) {\r\n      const point = data[i]\r\n      if ( this.constains( point, eventPixel ) ) {\r\n        return point\r\n      }\r\n    }\r\n    return null\r\n  }\r\n  // pixel 坐标是否在 point 范围内\r\n  constains( point, pixel ) {\r\n    const offset = this.cluster.isCluster( point )\r\n      ? this.clusterOffset\r\n      : this.normalOffset\r\n    const { width, height } = offset\r\n    const {\r\n      renderPixel: { x: x1, y: y1 }\r\n    } = point\r\n    const { x: x2, y: y2 } = pixel\r\n    return (\r\n      x2 >= x1 + width[0] &&\r\n      x2 <= x1 + width[1] &&\r\n      y2 >= y1 + height[0] &&\r\n      y2 <= y1 + height[1]\r\n    )\r\n  }\r\n}\r\n","import Canvas from './canvas'\r\nimport ClusterItem from './clusterItem'\r\nimport AmapCoordinate from './amap.coordinate'\r\nimport MercatorCoordinate from './mercator.coordinate'\r\nimport Event from './event'\r\n\r\n// 开发环境输出日志\r\nconst debug = process.env.NODE_ENV === 'development'\r\n\r\n// 聚合策略\r\nexport const Coordinate = {\r\n  MERCATOR: 'MERCATOR', // 使用 墨卡托 坐标系\r\n  AMAP: 'AMAP' // 使用高德地图容器的相对坐标\r\n}\r\n\r\n// 默认的点样式\r\nconst defaultStyle = {\r\n  width: 60,\r\n  height: 69\r\n}\r\n// 聚合默认设置\r\nconst defaultOptions = {\r\n  coordinate: Coordinate.AMAP, // 聚合策略\r\n  maxZoom: 18, // 最大的聚合级别，大于该级别就不进行相应的聚合\r\n  gridSize: 60, // 聚合计算时，网格的像素大小\r\n  minClusterSize: 2, // 聚合的最小数量，小于该数量个点则不能成为一个聚合\r\n  averageCenter: true, // 是否取所有点的平均值作为聚合点中心\r\n  zoomOnClick: true, // 点击聚合点时，是否展开聚合\r\n  zIndex: 120, // canvas图层的zindex\r\n  visible: true, // 是否显示\r\n  offset: null, // 绘制图形相对于定位点的偏移度\r\n  getPosition( item ) {\r\n    // 获取经纬度信息\r\n    const { location } = item\r\n    return location ? [location.longitude, location.latitude] : null\r\n  },\r\n  render: null, // 绘制函数\r\n  hoverRender: null, // hover状态下的绘制函数\r\n  // 以下参数主要用于事件系统\r\n  clickHandler: null, // click事件\r\n  mouseoutHandler: null, // mouseout事件\r\n  mouseoverHandler: null, // mouseover事件\r\n  mousemoveHandler: null, // mousemove事件\r\n  normalPointStyle: defaultStyle, // 实体点的样式\r\n  clusterPointStyle: defaultStyle, // 聚合点的样式\r\n  hoverNormalPointStyle: defaultStyle, // hover状态下实体点的样式\r\n  hoverClusterPointStyle: defaultStyle // hover状态下聚合点的样式\r\n}\r\n\r\nexport default class Cluster {\r\n  constructor( options ) {\r\n    this.data = null\r\n    this.renderData = null\r\n    this.points = []\r\n    this.clusterItems = null\r\n    this.options = Object.assign( {}, defaultOptions, options )\r\n    this.options.data = null\r\n    this.eventEngine = new Event( this )\r\n    this.renderEngine = new Canvas( {\r\n      map: this.options.map,\r\n      zIndex: this.options.zIndex,\r\n      visible: this.options.visible,\r\n      render: this.build.bind( this )\r\n    } )\r\n    this.coordinateEngine =\r\n      options.coordinate === Coordinate.AMAP\r\n        ? new AmapCoordinate( this.options )\r\n        : new MercatorCoordinate( this.options )\r\n    this.setData( options.data, false )\r\n  }\r\n  setData( data, rebuild = true ) {\r\n    const {\r\n      options: { getPosition }\r\n    } = this\r\n    this.data = []\r\n    if ( data ) {\r\n      data.forEach( item => {\r\n        item.position = getPosition( item )\r\n        this.data.push( item )\r\n      } )\r\n    }\r\n    if ( rebuild ) {\r\n      this.build()\r\n    }\r\n  }\r\n  build() {\r\n    if ( debug ) {\r\n      console.time( '聚合构建时间：' )\r\n    }\r\n    this.buildCusterItem()\r\n    this.updatePoints()\r\n    this.render()\r\n    if ( debug ) {\r\n      console.timeEnd( '聚合构建时间：' )\r\n      console.log( '%c构建聚合模块数量：' + this.points.length, 'color: red' )\r\n    }\r\n  }\r\n  buildCusterItem() {\r\n    const options = {\r\n      coordinateEngine: this.coordinateEngine,\r\n      averageCenter: this.options.averageCenter\r\n    }\r\n    this.clusterItems = []\r\n    this.renderData = this.coordinateEngine.getRenderData( this.data )\r\n    this.renderData.forEach( point => {\r\n      let parent = null\r\n      let distance = -1 // 当前点与聚合中心的距离\r\n      const {\r\n        coordinate: { x: pointX, y: pointY }\r\n      } = point\r\n      this.clusterItems.forEach( clusterItem => {\r\n        if ( clusterItem.contains( point ) ) {\r\n          const {\r\n            coordinate: { x: centerX, y: centerY }\r\n          } = clusterItem\r\n          const currDistance =\r\n            Math.pow( pointX - centerX, 2 ) + Math.pow( pointY - centerY, 2 )\r\n          if ( distance < 0 || distance > currDistance ) {\r\n            // 取距离最近的一个聚合\r\n            parent = clusterItem\r\n            distance = currDistance\r\n          }\r\n        }\r\n      } )\r\n      if ( parent ) {\r\n        // 该点找到聚合对象\r\n        parent.addPoint( point )\r\n      } else {\r\n        // 以该点为中心创建一个聚合对象\r\n        const clusterItem = new ClusterItem( point, options )\r\n        this.clusterItems.push( clusterItem )\r\n      }\r\n    } )\r\n  }\r\n  updatePoints() {\r\n    const {\r\n      clusterItems,\r\n      options: { map, minClusterSize, maxZoom }\r\n    } = this\r\n    if ( map.getZoom() >= maxZoom ) {\r\n      // 地图放大最大层级，就不存在聚合点了\r\n      this.points = clusterItems.reduce(\r\n        ( pre, curr ) => pre.concat( curr.points ),\r\n        []\r\n      )\r\n    } else {\r\n      // 返回的点数据应该是聚合点+实体点\r\n      let points = []\r\n      clusterItems.forEach( clusterItem => {\r\n        if ( clusterItem.getCount() >= minClusterSize ) {\r\n          // 聚合点\r\n          points.push( clusterItem )\r\n        } else {\r\n          // 实体点\r\n          points = points.concat( clusterItem.points )\r\n        }\r\n      } )\r\n      this.points = points\r\n    }\r\n  }\r\n  renderLater( delay ) {\r\n    if ( !this.renderTimer ) {\r\n      this.renderTimer = setTimeout( this.render.bind( this ), delay || 50 )\r\n    }\r\n  }\r\n  render() {\r\n    const {\r\n      points,\r\n      options: { render },\r\n      renderEngine: { pixelRatio, clusterCanvasCxt }\r\n    } = this\r\n    if ( !this.isFunction( render ) ) {\r\n      return\r\n    }\r\n    if ( this.renderTimer ) {\r\n      clearTimeout( this.renderTimer )\r\n      this.renderTimer = null\r\n    }\r\n    if ( debug ) {\r\n      console.time( '绘制时间：' )\r\n    }\r\n    // 清理画布\r\n    this.clearCluster()\r\n    // 绘制\r\n    points.forEach( ( point, index ) => {\r\n      const params = this.getParams( point )\r\n      // 定位到中心位置\r\n      render(\r\n        clusterCanvasCxt,\r\n        point.renderPixel.x * pixelRatio,\r\n        point.renderPixel.y * pixelRatio,\r\n        params.style.width,\r\n        params.style.height,\r\n        {\r\n          index,\r\n          data: params.data,\r\n          isCluster: params.isCluster\r\n        },\r\n        points\r\n      )\r\n    } )\r\n    if ( debug ) {\r\n      console.timeEnd( '绘制时间：' )\r\n    }\r\n  }\r\n  renderHoverPoint( params ) {\r\n    if ( this.isFunction( this.options.hoverRender ) ) {\r\n      const {\r\n        isCluster,\r\n        data: {\r\n          renderPixel: { x, y }\r\n        }\r\n      } = params\r\n      const {\r\n        renderEngine,\r\n        renderEngine: { hoverCanvasCtx },\r\n        options: { hoverRender, hoverNormalPointStyle, hoverClusterPointStyle }\r\n      } = this\r\n      const style = isCluster ? hoverClusterPointStyle : hoverNormalPointStyle\r\n      const { width, height } = style\r\n      const pixelRatio = renderEngine.getPixelRatio()\r\n      const canvasLeft = x * pixelRatio\r\n      const canvasTop = y * pixelRatio\r\n      hoverRender( hoverCanvasCtx, canvasLeft, canvasTop, width, height, params )\r\n    }\r\n  }\r\n  // 清除聚合\r\n  clearCluster() {\r\n    const {\r\n      renderEngine,\r\n      renderEngine: { clusterCanvas },\r\n      options: { map }\r\n    } = this\r\n    const { width, height } = map.getSize()\r\n    renderEngine.setCanvasSize( clusterCanvas, width, height )\r\n  }\r\n  // 清除 hover 点\r\n  clearHoverPoint() {\r\n    const {\r\n      renderEngine,\r\n      renderEngine: { hoverCanvas },\r\n      options: { map }\r\n    } = this\r\n    const { width, height } = map.getSize()\r\n    renderEngine.setCanvasSize( hoverCanvas, width, height )\r\n  }\r\n  getPoints() {\r\n    return this.points\r\n  }\r\n  getParams( point ) {\r\n    const isCluster = this.isCluster( point )\r\n    return {\r\n      isCluster,\r\n      data: point,\r\n      style: isCluster\r\n        ? this.options.clusterPointStyle\r\n        : this.options.normalPointStyle\r\n    }\r\n  }\r\n  isCluster( point ) {\r\n    return point instanceof ClusterItem\r\n  }\r\n  isFunction( fn ) {\r\n    return typeof fn === 'function'\r\n  }\r\n}\r\n","// import Cluster from './lib/cluster'\r\nimport Cluster, { Coordinate } from '../src/cluster'\r\n\r\nfunction drawCircle( ctx, x, y, r, color = 'red' ) {\r\n  ctx.fillStyle = color\r\n  ctx.beginPath()\r\n  ctx.arc( x, y, r, 0, Math.PI * 2 )\r\n  ctx.fill()\r\n}\r\n\r\nfunction drawText( ctx, x, y, text, color = 'white' ) {\r\n  ctx.font = '18px SimHei'\r\n  ctx.textAlign = 'center'\r\n  ctx.textBaseline = 'middle'\r\n  ctx.fillStyle = color\r\n  ctx.fillText( text, x, y )\r\n}\r\n\r\nfunction random( basic, offset ) {\r\n  let change = Math.random() * offset\r\n  change = Math.random() > 0.5 ? change : -change\r\n  return basic + change\r\n}\r\n\r\nconst data = []\r\nconst longitude = 117.000923\r\nconst latitude = 36.675807\r\nfor ( let i = 0; i < 1000; i++ ) {\r\n  data.push( [random( longitude, 5 ), random( latitude, 5 )] )\r\n}\r\n\r\nfunction initCanvasCluster( options ) {\r\n  // `cluster` 依赖 `AMap.CustomLayer`\r\n  AMap.plugin( 'AMap.CustomLayer', function() {\r\n    const cluster = new Cluster( {\r\n      data,\r\n      map: options.map,\r\n      type: options.type,\r\n      averageCenter: true,\r\n      offset: ['-50%', '-100%'],\r\n      normalPointStyle: {\r\n        width: 30,\r\n        height: 30\r\n      },\r\n      clusterPointStyle: {\r\n        width: 60,\r\n        height: 60\r\n      },\r\n      hoverNormalPointStyle: {\r\n        width: 30,\r\n        height: 30\r\n      },\r\n      hoverClusterPointStyle: {\r\n        width: 60,\r\n        height: 60\r\n      },\r\n      getPosition: item => item,\r\n      mousemoveHandler( event, data ) {\r\n        // console.log( 'mousemove: ', {event,data} )\r\n      },\r\n      mouseoutHandler( data ) {\r\n        // console.log( 'mouseout: ', data )\r\n      },\r\n      mouseoverHandler( data ) {\r\n        // console.log( 'mouseover: ', data )\r\n      },\r\n      render( ctx, x, y, width, height, point ) {\r\n        /**\r\n         * 因为绘制圆，`定位点` 是作为圆心，所以默认相当于偏于了 [-50%,-50%]；\r\n         * 要把图形绘制到 `定位点` 上方，还需要再 Y 轴上面添加 -50% 的偏移度\r\n         * offset: [-50%, -100%] 就完成了 `定位点` 在图形正下方\r\n         */\r\n        const { isCluster, data } = point\r\n        const r = width / 2\r\n        const centerX = x\r\n        const centerY = y - r - 3\r\n        if ( isCluster ) {\r\n          drawCircle( ctx, centerX, centerY, r )\r\n          drawText( ctx, centerX, centerY, data.getCount() )\r\n          // 定位点\r\n          drawCircle( ctx, x, y, 3, 'green' )\r\n        } else {\r\n          drawCircle( ctx, centerX, centerY, r, 'green' )\r\n        }\r\n      },\r\n      hoverRender( ctx, x, y, width, height, point ) {\r\n        const { isCluster, data } = point\r\n        const r = width / 2\r\n        const centerX = x\r\n        const centerY = y - r - 3\r\n        if ( isCluster ) {\r\n          drawCircle( ctx, centerX, centerY, r, 'white' )\r\n          drawText( ctx, centerX, centerY, data.getCount(), 'red' )\r\n        } else {\r\n          drawCircle( ctx, centerX, centerY, r, 'blue' )\r\n        }\r\n      }\r\n    } )\r\n    window.cluster = cluster\r\n  } )\r\n}\r\nfunction initAmapCluster( map ) {\r\n  const markers = data.map(\r\n    item =>\r\n      new AMap.Marker( {\r\n        position: item\r\n      } )\r\n  )\r\n  /*eslint-disable*/\r\n  new AMap.MarkerClusterer(map, markers, {\r\n    gridSize: 60,\r\n  })\r\n}\r\nconst amapMap = new AMap.Map('amap', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\nconst mercatorMap = new AMap.Map('mercator', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\nconst markerMap = new AMap.Map('marker', {\r\n  zoom: 6,\r\n  center: [longitude, latitude],\r\n})\r\ninitCanvasCluster({\r\n  map: amapMap,\r\n  type: Coordinate.AMAP,\r\n})\r\ninitCanvasCluster({\r\n  map: mercatorMap,\r\n  type: Coordinate.MERCATOR,\r\n})\r\ninitAmapCluster(markerMap)\r\n"],"names":["Canvas","options","layer","hoverCanvas","hoverCanvasCtx","clusterCanvas","clusterCanvasCxt","pixelRatio","getPixelRatio","init","map","visible","zIndex","render","container","document","createElement","style","position","appendChild","getContext","AMap","CustomLayer","zooms","Math","min","round","window","devicePixelRatio","canvas","w","h","width","height","ClusterItem","point","renderPixel","points","coordinate","averageCenter","coordinateEngine","length","centerX","x","centerY","y","newAddPoint","pointX","pointY","totalX","totalY","newCenterX","newCenterY","coordinateToPixel","centerPoint","push","updateCenter","gridSize","getGridSize","AmapCoordinate","data","renderData","bounds","getBounds","forEach","item","contains","lngLatToContainer","lonLat2Mercator","lonLat","longitude","latitude","log","tan","PI","mercator2LonLat","pixel","atan","exp","getOffsetValue","value","offset","type","_offset","trim","substr","Number","parseFloat","getOffset","Array","isArray","widthOffset","heightOffset","MercatorCoordinate","pow","getZoom","getExtendedBounds","southWest","getSouthWest","northEast","getNorthEast","tr","lng","lat","bl","Event","cluster","hoverPoint","zooming","click","clickHandler","mouseout","mouseoutHandler","mouseover","mouseoverHandler","mousemove","mousemoveHandler","zoomOnClick","normalOffset","normalPointStyle","clusterOffset","clusterPointStyle","initEvent","on","bind","zoomstartHandler","zoomendHandler","event","findPoint","isCluster","params","zoomOnClickHandler","isFunction","constains","clearHoverPoint","getParams","renderHoverPoint","Pixel","lnglat","containerToLngLat","setCenter","zoomIn","eventPixel","getPoints","i","x1","y1","x2","y2","Coordinate","MERCATOR","AMAP","defaultStyle","defaultOptions","maxZoom","minClusterSize","getPosition","location","hoverRender","hoverNormalPointStyle","hoverClusterPointStyle","Cluster","clusterItems","Object","assign","eventEngine","renderEngine","build","setData","rebuild","console","time","buildCusterItem","updatePoints","timeEnd","getRenderData","parent","distance","clusterItem","currDistance","addPoint","reduce","pre","curr","concat","getCount","delay","renderTimer","setTimeout","clearTimeout","clearCluster","index","canvasLeft","canvasTop","getSize","setCanvasSize","fn","drawCircle","ctx","r","color","fillStyle","beginPath","arc","fill","drawText","text","font","textAlign","textBaseline","fillText","random","basic","change","initCanvasCluster","plugin","initAmapCluster","markers","Marker","MarkerClusterer","amapMap","Map","zoom","center","mercatorMap","markerMap"],"mappings":"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"}