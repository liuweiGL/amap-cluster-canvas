!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.layer=null,this.hoverCanvas=null,this.hoverCanvasCtx=null,this.clusterCanvas=null,this.clusterCanvasCxt=null,this.options=e,this._init()}return i(t,[{key:"_init",value:function(){var t=this.options,e=t.map,n=t.visible,i=t.zIndex,r=document.createElement("div"),o=document.createElement("canvas");o.style.position="absolute";var s=document.createElement("canvas");s.style.position="absolute",r.appendChild(o),r.appendChild(s),this.clusterCanvas=o,this.hoverCanvas=s,this.clusterCanvasCxt=o.getContext("2d"),this.hoverCanvasCtx=s.getContext("2d"),this.layer=new AMap.CustomLayer(r,{map:e,zIndex:i,visible:n,zooms:[1,20]})}},{key:"getPixelRatio",value:function(){return Math.min(2,Math.round(window.devicePixelRatio||1))}},{key:"setCanvasSize",value:function(t,e,n){var i=this.getPixelRatio();t.width=e*i,t.height=n*i,t.style.width=e+"px",t.style.height=n+"px"}},{key:"clearCluster",value:function(){var t=this.options.map.getSize(),e=t.width,n=t.height;this.setCanvasSize(this.clusterCanvas,e,n)}}]),t}(),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var s=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.coordinate=e.coordinate,this.points=[e],this.options=n}return o(t,[{key:"getCount",value:function(){return this.points.length}},{key:"updateCenter",value:function(){var t=this.points,e=this.points.length,n=this.coordinate,i=n.x,r=n.y;if(this.options.isAverageCenter){var o=t[e-1].coordinate,s=(i*(e-1)+o.x)/e,a=(r*(e-1)+o.y)/e;this.coordinate={x:s,y:a}}}},{key:"addPoint",value:function(t){this.points.push(t),this.updateCenter()}},{key:"contains",value:function(t){var e=t.coordinate,n=e.x,i=e.y,r=this.coordinate,o=r.x,s=r.y,a=this.options.gridSize;return n>=o-a&&n<=o+a&&i>=s-a&&i<=s+a}}]),t}();n.d(e,"ClusterTypes",function(){return l});var a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();var l={ZOOM:"zoom",PIXEL:"pixel"},c={width:60,height:69},h={type:l.PIXEL,maxZoom:18,gridSize:60,minClusterSize:2,averageCenter:!0,zoomOnClick:!0,zIndex:120,visible:!0,getPosition:function(t){var e=t.location;return e?[e.longitude,e.latitude]:null},render:null,hoverRender:null,clickHandler:null,mouseoutHandler:null,mouseoverHandler:null,mousemoveHandler:null,normalPointStyle:c,clusterPointStyle:c,hoverNormalPointStyle:c,hoverClusterPointStyle:c},d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.map,i=e.data;this.options=a({},h,e),this.zoom=null,this.points=null,this.buildFn=null,this.pixelFn=null,this.lastPixel={},this.oldHoverPoint=null,this.renderTimer=null,this.clusterItems=null,this.renderEngine=new r({map:n,zIndex:this.options.zIndex,visible:this.options.visible}),this._init(i),this._customEngine(),this._bindEvent()}return u(t,[{key:"renderLater",value:function(t){this.renderTimer||(this.renderTimer=setTimeout(this.render.bind(this),t||50))}},{key:"render",value:function(){var t=this,e=this.points,n=this.options,i=n.render,r=n.normalPointStyle,o=n.clusterPointStyle,s=this.renderEngine.clusterCanvasCxt;this.renderTimer&&(clearTimeout(this.renderTimer),this.renderTimer=null),this.renderEngine.clearCluster(),e.forEach(function(e){var n=t.pixelFn(e.coordinate),a=n.x,u=n.y,l=t._isCluster(e),c=l?o:r,h=c.width,d=c.height;i(s,a-h/2,u-d/2,h,d,{isCluster:l,data:e})})}},{key:"setData",value:function(t){this.data=t,this._buildCluster(),this.render()}},{key:"_init",value:function(t){this._createBuildFn(),this._createPixelFn(),this.setData(t)}},{key:"_createBuildFn",value:function(){var t=this,e=this.options,n=e.map,i=e.type,r=e.gridSize,o=e.averageCenter,s=e.getPosition;i===l.PIXEL?this.buildFn=function(){var e=n.getBounds(),i={gridSize:r,averageCenter:o};t.data.forEach(function(r){var o=s(r);o&&e.contains(o)&&(r.coordinate=n.lngLatToContainer(o),t._buildClusterItem(r,i))})}:this.buildFn=function(){var e=n.getZoom(),i={averageCenter:o,gridSize:r*Math.pow(2,18-e)};t.zoom=e,t.data.forEach(function(r){var o=s(r);o&&(r.coordinate=n.lnglatToPixel(o,e),t._buildClusterItem(r,i))})}}},{key:"_createPixelFn",value:function(){var t=this.zoom,e=this.options,n=e.type,i=e.map;n===l.PIXEL?this.pixelFn=function(t){return t}:this.pixelFn=function(e){var n=i.pixelToLngLat(e,t);return i.lngLatToContainer(n)}}},{key:"_buildCluster",value:function(){this.clusterItems=[],this.data&&(this.buildFn(),this._updatePoints())}},{key:"_buildClusterItem",value:function(t,e){var n=null,i=-1,r=t.coordinate,o=r.x,a=r.y;if(this.clusterItems.forEach(function(e){if(e.contains(t)){var r=e.coordinate,s=r.x,u=r.y,l=Math.pow(o-s,2)+Math.pow(a-u,2);(i<0||i>l)&&(n=e,i=l)}}),n)n.addPoint(t);else{var u=new s(t,e);this.clusterItems.push(u)}}},{key:"_updatePoints",value:function(){var t=this.clusterItems,e=this.options,n=e.map,i=e.minClusterSize,r=e.maxZoom;if(n.getZoom()>=r)this.points=t.reduce(function(t,e){return t.concat(e.points)},[]);else{var o=[];t.forEach(function(t){t.getCount()>=i?o.push(t):o=o.concat(t.points)}),this.points=o}}},{key:"_customEngine",value:function(){this.renderEngine.layer.render=this.render.bind(this)}},{key:"_bindEvent",value:function(){var t=this.options.map;t.on("moveend",this._buildCluster.bind(this)),t.on("zoomchange",this._buildCluster.bind(this)),t.on("click",this._clickHandler.bind(this)),t.on("mousemove",this._mousemoveHandler.bind(this))}},{key:"_clickHandler",value:function(t){var e=t.pixel,n=this._findEventPoint(e);if(n){var i=this.options,r=i.zoomOnClick,o=i.clickHandler,s={data:n,isCluster:this._isCluster(n)};this.mouseoutHandler(),r&&this._zoomOnClickHandler(s),this._isFunction(o)&&o(s)}}},{key:"_mousemoveHandler",value:function(t){var e=t.pixel,n=this.lastPixel,i=this.oldHoverPoint;if(n.x!==e.x||n.y!==e.y){var r=this._findEventPoint(e);r!==i&&(this.mouseoutHandler(r),this.mouseoverHandler(r),this.lastPixel=e)}}},{key:"mouseoutHandler",value:function(t){var e=this.oldHoverPoint,n=this.options.mouseoutHandler;e&&(this._clearHoverPoint(),this._isFunction(n)&&n({data:e,isCluster:this._isCluster(e)})),this.oldHoverPoint=t}},{key:"mouseoverHandler",value:function(t){if(t){var e=this.options.mouseoverHandler,n={data:t,isCluster:this._isCluster(t)};this._drawHoverPoint(n),this._isFunction(e)&&e(n)}}},{key:"_zoomOnClickHandler",value:function(t){var e=t.isCluster,n=t.data.coordinate;if(e){var i=this.options.map,r=(0,this.pixelFn)(n),o=i.containerToLngLat(r);i.setCenter(o),i.zoomIn()}}},{key:"_findEventPoint",value:function(t){var e=this,n=this.points,i=this._constains,r=this.options,o=r.normalPointStyle,s=r.clusterPointStyle,a=[],u=[];n.forEach(function(t){e._isCluster(t)?a.push(t):u.push(t)});for(var l=0,c=a.length;l<c;l++){var h=a[l];if(i(h.coordinate,t,s))return h}for(var d=0,v=u.length;d<v;d++){var f=u[d];if(i(f.coordinate,t,o))return f}return null}},{key:"_constains",value:function(t,e,n){var i=n.width,r=n.height,o=t.x,s=t.y,a=e.x,u=e.y;return a>=o-i/2&&a<=o+i/2&&u>=s-r/2&&u<=s+r/2}},{key:"_isFunction",value:function(t){return"function"==typeof t}},{key:"_isCluster",value:function(t){return t instanceof s}},{key:"_drawHoverPoint",value:function(t){var e=this.options,n=e.hoverRender,i=e.normalPointStyle,r=e.clusterPointStyle,o=this.renderEngine,s=this.renderEngine,a=s.hoverCanvas,u=s.hoverCanvasCtx;if(this._isFunction(n)){var l=t.isCluster,c=t.data.coordinate,h=c.x,d=c.y,v=l?r:i,f=v.width,p=v.height,y=f+20,m=p+20,C=h-y/2,g=d-m/2,b=o.getPixelRatio();a.style.left=C+"px",a.style.top=g+"px",a.style.cursor="pointer",o.setCanvasSize(a,y,m),u.save(),u.translate(-C*b,-g*b),n(u,C+10,g+10,f,p,t),u.restore()}}},{key:"_clearHoverPoint",value:function(){var t=this.renderEngine,e=this.renderEngine.hoverCanvas;t.setCanvasSize(e,0,0)}}]),t}();e.default=d}]);